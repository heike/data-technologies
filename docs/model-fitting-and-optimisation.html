<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 16 Model fitting and optimisation | Data Science and Statistical Thinking: With Wild-Caught Data and R</title>
  <meta name="description" content="Chapter 16 Model fitting and optimisation | Data Science and Statistical Thinking: With Wild-Caught Data and R" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 16 Model fitting and optimisation | Data Science and Statistical Thinking: With Wild-Caught Data and R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 16 Model fitting and optimisation | Data Science and Statistical Thinking: With Wild-Caught Data and R" />
  
  
  

<meta name="author" content="Heike Hofmann, Dianne Cook, Susan Vanderplas and Earo Wang" />


<meta name="date" content="2023-06-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="variation-and-inference-1.html"/>
<link rel="next" href="generalied-linear-models.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.10.1.9000/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Science and Statistical Thinking</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preamble</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#what-is-exploratory-data-analysis"><i class="fa fa-check"></i><b>2.1</b> What is exploratory data analysis?</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#what-is-wild-data"><i class="fa fa-check"></i><b>2.2</b> What is <strong>wild</strong> data?</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#what-is-computational-statistical-thinking"><i class="fa fa-check"></i><b>2.3</b> What is computational statistical thinking?</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#workflow"><i class="fa fa-check"></i><b>2.4</b> Workflow</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="accessing-data.html"><a href="accessing-data.html"><i class="fa fa-check"></i><b>3</b> Accessing Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="accessing-data.html"><a href="accessing-data.html#flat-files"><i class="fa fa-check"></i><b>3.1</b> Flat files</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="accessing-data.html"><a href="accessing-data.html#example-tuberculosis"><i class="fa fa-check"></i><b>3.1.1</b> Example: tuberculosis</a></li>
<li class="chapter" data-level="3.1.2" data-path="accessing-data.html"><a href="accessing-data.html#your-turn-atmospheric-carbon-dioxide"><i class="fa fa-check"></i><b>3.1.2</b> Your turn: atmospheric carbon dioxide</a></li>
<li class="chapter" data-level="3.1.3" data-path="accessing-data.html"><a href="accessing-data.html#example-standardised-test-scores-for-reading-science-and-math"><i class="fa fa-check"></i><b>3.1.3</b> Example: standardised test scores for reading, science and math</a></li>
<li class="chapter" data-level="3.1.4" data-path="accessing-data.html"><a href="accessing-data.html#your-turn-land-surface-weather-station-data"><i class="fa fa-check"></i><b>3.1.4</b> Your turn: land surface weather station data</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="accessing-data.html"><a href="accessing-data.html#proprietary-formats"><i class="fa fa-check"></i><b>3.2</b> Proprietary formats</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="accessing-data.html"><a href="accessing-data.html#example-australia-air-traffic-data"><i class="fa fa-check"></i><b>3.2.1</b> Example: Australia air traffic data</a></li>
<li class="chapter" data-level="3.2.2" data-path="accessing-data.html"><a href="accessing-data.html#your-turn-munging-spreadsheets"><i class="fa fa-check"></i><b>3.2.2</b> Your turn: Munging spreadsheets</a></li>
<li class="chapter" data-level="3.2.3" data-path="accessing-data.html"><a href="accessing-data.html#example-spss-binary"><i class="fa fa-check"></i><b>3.2.3</b> Example: SPSS binary</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="accessing-data.html"><a href="accessing-data.html#reading-multiple-files-from-a-website"><i class="fa fa-check"></i><b>3.3</b> Reading multiple files from a website</a></li>
<li class="chapter" data-level="3.4" data-path="accessing-data.html"><a href="accessing-data.html#json"><i class="fa fa-check"></i><b>3.4</b> JSON</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="accessing-data.html"><a href="accessing-data.html#example-crossrates"><i class="fa fa-check"></i><b>3.4.1</b> Example: Crossrates</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="accessing-data.html"><a href="accessing-data.html#shapefiles"><i class="fa fa-check"></i><b>3.5</b> Shapefiles</a></li>
<li class="chapter" data-level="3.6" data-path="accessing-data.html"><a href="accessing-data.html#apis"><i class="fa fa-check"></i><b>3.6</b> APIs</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="accessing-data.html"><a href="accessing-data.html#melbourne-pedestrian-traffic-rwalkr"><i class="fa fa-check"></i><b>3.6.1</b> Melbourne pedestrian traffic: <code>rwalkr</code></a></li>
<li class="chapter" data-level="3.6.2" data-path="accessing-data.html"><a href="accessing-data.html#australian-weather-bomrang"><i class="fa fa-check"></i><b>3.6.2</b> Australian weather: <code>bomrang</code></a></li>
<li class="chapter" data-level="3.6.3" data-path="accessing-data.html"><a href="accessing-data.html#atlas-of-living-austraila-ala4r"><i class="fa fa-check"></i><b>3.6.3</b> Atlas of Living Austraila: <code>ala4R</code></a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="accessing-data.html"><a href="accessing-data.html#images-as-data"><i class="fa fa-check"></i><b>3.7</b> Images as data</a></li>
<li class="chapter" data-level="3.8" data-path="accessing-data.html"><a href="accessing-data.html#databases"><i class="fa fa-check"></i><b>3.8</b> Databases</a></li>
<li class="chapter" data-level="3.9" data-path="accessing-data.html"><a href="accessing-data.html#working-with-text"><i class="fa fa-check"></i><b>3.9</b> Working with text</a></li>
<li class="chapter" data-level="3.10" data-path="accessing-data.html"><a href="accessing-data.html#scraping-data"><i class="fa fa-check"></i><b>3.10</b> Scraping Data</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="accessing-data.html"><a href="accessing-data.html#examples"><i class="fa fa-check"></i><b>3.10.1</b> Examples</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html"><i class="fa fa-check"></i><b>4</b> Tidying Common Data Formats</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#terminology"><i class="fa fa-check"></i><b>4.1</b> Terminology</a></li>
<li class="chapter" data-level="4.2" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#tidy-tabular-form"><i class="fa fa-check"></i><b>4.2</b> Tidy tabular form</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#wide-format"><i class="fa fa-check"></i><b>4.2.1</b> Wide format</a></li>
<li class="chapter" data-level="4.2.2" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#long-format"><i class="fa fa-check"></i><b>4.2.2</b> Long format</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#raw-data-examples"><i class="fa fa-check"></i><b>4.3</b> Raw data examples</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#gene-expression-experiment"><i class="fa fa-check"></i><b>4.3.1</b> Gene expression experiment</a></li>
<li class="chapter" data-level="4.3.2" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#melbourne-weather"><i class="fa fa-check"></i><b>4.3.2</b> Melbourne weather</a></li>
<li class="chapter" data-level="4.3.3" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#tb-incidence"><i class="fa fa-check"></i><b>4.3.3</b> TB incidence</a></li>
<li class="chapter" data-level="4.3.4" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#french-fries"><i class="fa fa-check"></i><b>4.3.4</b> French fries</a></li>
<li class="chapter" data-level="4.3.5" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#contingency-table"><i class="fa fa-check"></i><b>4.3.5</b> Contingency table</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#abs-datapack"><i class="fa fa-check"></i><b>4.4</b> ABS Datapack</a></li>
<li class="chapter" data-level="4.5" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#messy-vs-tidy"><i class="fa fa-check"></i><b>4.5</b> Messy vs tidy</a></li>
<li class="chapter" data-level="4.6" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#tidy-verbs"><i class="fa fa-check"></i><b>4.6</b> Tidy verbs</a></li>
<li class="chapter" data-level="4.7" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#tidying-genes-data"><i class="fa fa-check"></i><b>4.7</b> Tidying genes data</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#separate-columns"><i class="fa fa-check"></i><b>4.7.1</b> Separate columns</a></li>
<li class="chapter" data-level="4.7.2" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#now-spread-to-examine-different-aspects"><i class="fa fa-check"></i><b>4.7.2</b> Now spread to examine different aspects</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#try-this-yourself"><i class="fa fa-check"></i><b>4.8</b> Try this yourself</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#exercise-1"><i class="fa fa-check"></i><b>4.8.1</b> Exercise 1</a></li>
<li class="chapter" data-level="4.8.2" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#exercise-2"><i class="fa fa-check"></i><b>4.8.2</b> Exercise 2</a></li>
<li class="chapter" data-level="4.8.3" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#exercise-3"><i class="fa fa-check"></i><b>4.8.3</b> Exercise 3</a></li>
<li class="chapter" data-level="4.8.4" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#exercise-4"><i class="fa fa-check"></i><b>4.8.4</b> Exercise 4</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#tidying-melbourne-weather"><i class="fa fa-check"></i><b>4.9</b> Tidying Melbourne weather</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#sometime-easier-to-index-select"><i class="fa fa-check"></i><b>4.9.1</b> Sometime easier to index select</a></li>
<li class="chapter" data-level="4.9.2" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#make-long-form"><i class="fa fa-check"></i><b>4.9.2</b> Make long form</a></li>
<li class="chapter" data-level="4.9.3" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#use-spread-to-look-at-different-things"><i class="fa fa-check"></i><b>4.9.3</b> Use spread to look at different things</a></li>
<li class="chapter" data-level="4.9.4" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#what-are-the-numbers"><i class="fa fa-check"></i><b>4.9.4</b> What are the numbers?</a></li>
<li class="chapter" data-level="4.9.5" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#now-use-spread"><i class="fa fa-check"></i><b>4.9.5</b> Now use spread</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="tidying-common-data-formats.html"><a href="tidying-common-data-formats.html#exercises"><i class="fa fa-check"></i><b>4.10</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="wrangling-data.html"><a href="wrangling-data.html"><i class="fa fa-check"></i><b>5</b> Wrangling Data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="wrangling-data.html"><a href="wrangling-data.html#overview"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="wrangling-data.html"><a href="wrangling-data.html#side-note-package-system"><i class="fa fa-check"></i><b>5.2</b> Side-note: Package system</a></li>
<li class="chapter" data-level="5.3" data-path="wrangling-data.html"><a href="wrangling-data.html#example-french-fries"><i class="fa fa-check"></i><b>5.3</b> Example: french fries</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="wrangling-data.html"><a href="wrangling-data.html#the-story-of-the-french-fries-data."><i class="fa fa-check"></i><b>5.3.1</b> The story of the french fries data….</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="wrangling-data.html"><a href="wrangling-data.html#filter-choose-observations"><i class="fa fa-check"></i><b>5.4</b> filter: choose observations</a></li>
<li class="chapter" data-level="5.5" data-path="wrangling-data.html"><a href="wrangling-data.html#select"><i class="fa fa-check"></i><b>5.5</b> select</a></li>
<li class="chapter" data-level="5.6" data-path="wrangling-data.html"><a href="wrangling-data.html#mutate"><i class="fa fa-check"></i><b>5.6</b> mutate</a></li>
<li class="chapter" data-level="5.7" data-path="wrangling-data.html"><a href="wrangling-data.html#summarise-and-group_by"><i class="fa fa-check"></i><b>5.7</b> summarise and group_by</a></li>
<li class="chapter" data-level="5.8" data-path="wrangling-data.html"><a href="wrangling-data.html#arrange"><i class="fa fa-check"></i><b>5.8</b> arrange</a></li>
<li class="chapter" data-level="5.9" data-path="wrangling-data.html"><a href="wrangling-data.html#count-tally"><i class="fa fa-check"></i><b>5.9</b> count, tally</a></li>
<li class="chapter" data-level="5.10" data-path="wrangling-data.html"><a href="wrangling-data.html#putting-it-together-to-problem-solve"><i class="fa fa-check"></i><b>5.10</b> Putting it together to problem solve</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="wrangling-data.html"><a href="wrangling-data.html#are-ratings-similar"><i class="fa fa-check"></i><b>5.10.1</b> Are ratings similar?</a></li>
<li class="chapter" data-level="5.10.2" data-path="wrangling-data.html"><a href="wrangling-data.html#are-reps-like-each-other"><i class="fa fa-check"></i><b>5.10.2</b> Are reps like each other</a></li>
<li class="chapter" data-level="5.10.3" data-path="wrangling-data.html"><a href="wrangling-data.html#replicates-by-rating-type"><i class="fa fa-check"></i><b>5.10.3</b> Replicates by rating type</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="wrangling-data.html"><a href="wrangling-data.html#exercise"><i class="fa fa-check"></i><b>5.11</b> Exercise</a></li>
<li class="chapter" data-level="5.12" data-path="wrangling-data.html"><a href="wrangling-data.html#relational-data-and-joins"><i class="fa fa-check"></i><b>5.12</b> Relational data, and joins</a>
<ul>
<li class="chapter" data-level="5.12.1" data-path="wrangling-data.html"><a href="wrangling-data.html#keys"><i class="fa fa-check"></i><b>5.12.1</b> Keys</a></li>
<li class="chapter" data-level="5.12.2" data-path="wrangling-data.html"><a href="wrangling-data.html#joins"><i class="fa fa-check"></i><b>5.12.2</b> Joins</a></li>
<li class="chapter" data-level="5.12.3" data-path="wrangling-data.html"><a href="wrangling-data.html#airline-travel-ontime-data"><i class="fa fa-check"></i><b>5.12.3</b> Airline travel, ontime data</a></li>
</ul></li>
<li class="chapter" data-level="5.13" data-path="wrangling-data.html"><a href="wrangling-data.html#exercise-5"><i class="fa fa-check"></i><b>5.13</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="handling-missings.html"><a href="handling-missings.html"><i class="fa fa-check"></i><b>6</b> Handling Missings</a>
<ul>
<li class="chapter" data-level="6.1" data-path="handling-missings.html"><a href="handling-missings.html#overview-1"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="handling-missings.html"><a href="handling-missings.html#a-story-of-missing-flights"><i class="fa fa-check"></i><b>6.2</b> A story of missing flights</a></li>
<li class="chapter" data-level="6.3" data-path="handling-missings.html"><a href="handling-missings.html#data-set-overview"><i class="fa fa-check"></i><b>6.3</b> Data set overview</a></li>
<li class="chapter" data-level="6.4" data-path="handling-missings.html"><a href="handling-missings.html#missing-value-patterns"><i class="fa fa-check"></i><b>6.4</b> Missing value patterns</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="handling-missings.html"><a href="handling-missings.html#missingness-map"><i class="fa fa-check"></i><b>6.4.1</b> Missingness map</a></li>
<li class="chapter" data-level="6.4.2" data-path="handling-missings.html"><a href="handling-missings.html#numerical-summaries"><i class="fa fa-check"></i><b>6.4.2</b> Numerical summaries</a></li>
<li class="chapter" data-level="6.4.3" data-path="handling-missings.html"><a href="handling-missings.html#tend-to-get-ignored-by-most-software"><i class="fa fa-check"></i><b>6.4.3</b> Tend to get ignored by most software</a></li>
<li class="chapter" data-level="6.4.4" data-path="handling-missings.html"><a href="handling-missings.html#add-them-to-plot"><i class="fa fa-check"></i><b>6.4.4</b> Add them to plot</a></li>
<li class="chapter" data-level="6.4.5" data-path="handling-missings.html"><a href="handling-missings.html#understanding-missing-dependencies"><i class="fa fa-check"></i><b>6.4.5</b> Understanding missing dependencies</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="handling-missings.html"><a href="handling-missings.html#shadow-matrix"><i class="fa fa-check"></i><b>6.5</b> Shadow matrix</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="handling-missings.html"><a href="handling-missings.html#relationship-with-other-variables"><i class="fa fa-check"></i><b>6.5.1</b> Relationship with other variables</a></li>
<li class="chapter" data-level="6.5.2" data-path="handling-missings.html"><a href="handling-missings.html#two-minute-challenge"><i class="fa fa-check"></i><b>6.5.2</b> Two minute challenge</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="handling-missings.html"><a href="handling-missings.html#strategy"><i class="fa fa-check"></i><b>6.6</b> Strategy</a></li>
<li class="chapter" data-level="6.7" data-path="handling-missings.html"><a href="handling-missings.html#common-ways-to-impute-values"><i class="fa fa-check"></i><b>6.7</b> Common ways to impute values</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="handling-missings.html"><a href="handling-missings.html#mean"><i class="fa fa-check"></i><b>6.7.1</b> Mean</a></li>
<li class="chapter" data-level="6.7.2" data-path="handling-missings.html"><a href="handling-missings.html#by-year"><i class="fa fa-check"></i><b>6.7.2</b> by year</a></li>
<li class="chapter" data-level="6.7.3" data-path="handling-missings.html"><a href="handling-missings.html#two-minute-challenge-1"><i class="fa fa-check"></i><b>6.7.3</b> Two minute challenge</a></li>
<li class="chapter" data-level="6.7.4" data-path="handling-missings.html"><a href="handling-missings.html#nearest-neighbors-imputation"><i class="fa fa-check"></i><b>6.7.4</b> Nearest neighbors imputation</a></li>
<li class="chapter" data-level="6.7.5" data-path="handling-missings.html"><a href="handling-missings.html#by-year-1"><i class="fa fa-check"></i><b>6.7.5</b> by year</a></li>
<li class="chapter" data-level="6.7.6" data-path="handling-missings.html"><a href="handling-missings.html#two-minute-challenge-2"><i class="fa fa-check"></i><b>6.7.6</b> Two minute challenge</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="handling-missings.html"><a href="handling-missings.html#exercise-6"><i class="fa fa-check"></i><b>6.8</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-visualization.html"><a href="data-visualization.html"><i class="fa fa-check"></i><b>7</b> Data Visualization</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-visualization.html"><a href="data-visualization.html#a-grammar-of-graphics"><i class="fa fa-check"></i><b>7.1</b> A grammar of graphics</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="data-visualization.html"><a href="data-visualization.html#what-is-a-data-plot"><i class="fa fa-check"></i><b>7.1.1</b> What is a data plot?</a></li>
<li class="chapter" data-level="7.1.2" data-path="data-visualization.html"><a href="data-visualization.html#why"><i class="fa fa-check"></i><b>7.1.2</b> Why?</a></li>
<li class="chapter" data-level="7.1.3" data-path="data-visualization.html"><a href="data-visualization.html#elements-of-the-grammar"><i class="fa fa-check"></i><b>7.1.3</b> Elements of the grammar</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="data-visualization.html"><a href="data-visualization.html#example-tuberculosis-data"><i class="fa fa-check"></i><b>7.2</b> Example: Tuberculosis data</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="data-visualization.html"><a href="data-visualization.html#charts"><i class="fa fa-check"></i><b>7.2.1</b> 100% charts</a></li>
<li class="chapter" data-level="7.2.2" data-path="data-visualization.html"><a href="data-visualization.html#bar-charts"><i class="fa fa-check"></i><b>7.2.2</b> Bar charts</a></li>
<li class="chapter" data-level="7.2.3" data-path="data-visualization.html"><a href="data-visualization.html#side-by-side-barcharts"><i class="fa fa-check"></i><b>7.2.3</b> Side-by-side barcharts</a></li>
<li class="chapter" data-level="7.2.4" data-path="data-visualization.html"><a href="data-visualization.html#separate-bar-charts"><i class="fa fa-check"></i><b>7.2.4</b> Separate bar charts</a></li>
<li class="chapter" data-level="7.2.5" data-path="data-visualization.html"><a href="data-visualization.html#pie-charts"><i class="fa fa-check"></i><b>7.2.5</b> Pie charts?</a></li>
<li class="chapter" data-level="7.2.6" data-path="data-visualization.html"><a href="data-visualization.html#rainbow-charts"><i class="fa fa-check"></i><b>7.2.6</b> Rainbow charts?</a></li>
<li class="chapter" data-level="7.2.7" data-path="data-visualization.html"><a href="data-visualization.html#pie-charts-1"><i class="fa fa-check"></i><b>7.2.7</b> Pie charts</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="data-visualization.html"><a href="data-visualization.html#variable-types-and-mapping"><i class="fa fa-check"></i><b>7.3</b> Variable types and mapping</a></li>
<li class="chapter" data-level="7.4" data-path="data-visualization.html"><a href="data-visualization.html#coordinate-systems"><i class="fa fa-check"></i><b>7.4</b> Coordinate systems</a></li>
<li class="chapter" data-level="7.5" data-path="data-visualization.html"><a href="data-visualization.html#layering"><i class="fa fa-check"></i><b>7.5</b> Layering</a></li>
<li class="chapter" data-level="7.6" data-path="data-visualization.html"><a href="data-visualization.html#colour-palettes"><i class="fa fa-check"></i><b>7.6</b> Colour palettes</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="data-visualization.html"><a href="data-visualization.html#choropleth-map"><i class="fa fa-check"></i><b>7.6.1</b> Choropleth map</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="data-visualization.html"><a href="data-visualization.html#colour-blindness"><i class="fa fa-check"></i><b>7.7</b> Colour blindness</a></li>
<li class="chapter" data-level="7.8" data-path="data-visualization.html"><a href="data-visualization.html#pre-attentive"><i class="fa fa-check"></i><b>7.8</b> Pre-attentive</a></li>
<li class="chapter" data-level="7.9" data-path="data-visualization.html"><a href="data-visualization.html#proximity"><i class="fa fa-check"></i><b>7.9</b> Proximity</a></li>
<li class="chapter" data-level="7.10" data-path="data-visualization.html"><a href="data-visualization.html#hierarchy-of-mappings"><i class="fa fa-check"></i><b>7.10</b> Hierarchy of mappings</a></li>
<li class="chapter" data-level="7.11" data-path="data-visualization.html"><a href="data-visualization.html#adding-interactivity-to-plots"><i class="fa fa-check"></i><b>7.11</b> Adding interactivity to plots</a></li>
<li class="chapter" data-level="7.12" data-path="data-visualization.html"><a href="data-visualization.html#themes"><i class="fa fa-check"></i><b>7.12</b> Themes</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html"><i class="fa fa-check"></i><b>8</b> Text data and strings</a>
<ul>
<li class="chapter" data-level="8.1" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#why-1"><i class="fa fa-check"></i><b>8.1</b> Why?</a></li>
<li class="chapter" data-level="8.2" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#process"><i class="fa fa-check"></i><b>8.2</b> Process</a></li>
<li class="chapter" data-level="8.3" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#resource"><i class="fa fa-check"></i><b>8.3</b> Resource</a></li>
<li class="chapter" data-level="8.4" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#getting-some-books-to-study"><i class="fa fa-check"></i><b>8.4</b> Getting some books to study</a></li>
<li class="chapter" data-level="8.5" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#tokenize"><i class="fa fa-check"></i><b>8.5</b> Tokenize</a></li>
<li class="chapter" data-level="8.6" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#your-turn-9"><i class="fa fa-check"></i><b>8.6</b> Your turn</a></li>
<li class="chapter" data-level="8.7" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#compare-the-word-frequency"><i class="fa fa-check"></i><b>8.7</b> Compare the word frequency</a></li>
<li class="chapter" data-level="8.8" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#book-comparison"><i class="fa fa-check"></i><b>8.8</b> Book comparison</a></li>
<li class="chapter" data-level="8.9" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#exercise-7"><i class="fa fa-check"></i><b>8.9</b> Exercise</a></li>
<li class="chapter" data-level="8.10" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#sentiment-analysis"><i class="fa fa-check"></i><b>8.10</b> Sentiment Analysis</a>
<ul>
<li class="chapter" data-level="8.10.1" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#lexicons"><i class="fa fa-check"></i><b>8.10.1</b> Lexicons</a></li>
<li class="chapter" data-level="8.10.2" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#analysis"><i class="fa fa-check"></i><b>8.10.2</b> Analysis</a></li>
<li class="chapter" data-level="8.10.3" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#comparing-lexicons"><i class="fa fa-check"></i><b>8.10.3</b> Comparing lexicons</a></li>
<li class="chapter" data-level="8.10.4" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#example-simpsons"><i class="fa fa-check"></i><b>8.10.4</b> Example: Simpsons</a></li>
<li class="chapter" data-level="8.10.5" data-path="text-data-and-strings.html"><a href="text-data-and-strings.html#example-afl-finals-tweets"><i class="fa fa-check"></i><b>8.10.5</b> Example: AFL Finals tweets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="dates-and-time.html"><a href="dates-and-time.html"><i class="fa fa-check"></i><b>9</b> Dates and time</a>
<ul>
<li class="chapter" data-level="9.1" data-path="dates-and-time.html"><a href="dates-and-time.html#overview-2"><i class="fa fa-check"></i><b>9.1</b> Overview</a></li>
<li class="chapter" data-level="9.2" data-path="dates-and-time.html"><a href="dates-and-time.html#working-with-dates"><i class="fa fa-check"></i><b>9.2</b> Working with dates</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="dates-and-time.html"><a href="dates-and-time.html#parsing-dates-with-time-zones"><i class="fa fa-check"></i><b>9.2.1</b> Parsing dates with time zones</a></li>
<li class="chapter" data-level="9.2.2" data-path="dates-and-time.html"><a href="dates-and-time.html#parsing-date-with-times"><i class="fa fa-check"></i><b>9.2.2</b> Parsing date with times</a></li>
<li class="chapter" data-level="9.2.3" data-path="dates-and-time.html"><a href="dates-and-time.html#extracting-temporal-elements"><i class="fa fa-check"></i><b>9.2.3</b> Extracting temporal elements</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="dates-and-time.html"><a href="dates-and-time.html#example-pedestrian-sensor"><i class="fa fa-check"></i><b>9.3</b> Example: pedestrian sensor</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="dates-and-time.html"><a href="dates-and-time.html#make-some-plots"><i class="fa fa-check"></i><b>9.3.1</b> Make some plots</a></li>
<li class="chapter" data-level="9.3.2" data-path="dates-and-time.html"><a href="dates-and-time.html#what-might-be-wrong-with-these-interpretations"><i class="fa fa-check"></i><b>9.3.2</b> What might be wrong with these interpretations?</a></li>
<li class="chapter" data-level="9.3.3" data-path="dates-and-time.html"><a href="dates-and-time.html#to-think-about"><i class="fa fa-check"></i><b>9.3.3</b> To think about</a></li>
<li class="chapter" data-level="9.3.4" data-path="dates-and-time.html"><a href="dates-and-time.html#beyond-aggregation"><i class="fa fa-check"></i><b>9.3.4</b> Beyond aggregation</a></li>
<li class="chapter" data-level="9.3.5" data-path="dates-and-time.html"><a href="dates-and-time.html#incorporating-time"><i class="fa fa-check"></i><b>9.3.5</b> Incorporating time</a></li>
<li class="chapter" data-level="9.3.6" data-path="dates-and-time.html"><a href="dates-and-time.html#on-a-calendar"><i class="fa fa-check"></i><b>9.3.6</b> On a calendar</a></li>
<li class="chapter" data-level="9.3.7" data-path="dates-and-time.html"><a href="dates-and-time.html#holidays"><i class="fa fa-check"></i><b>9.3.7</b> Holidays</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="dates-and-time.html"><a href="dates-and-time.html#exercise-8"><i class="fa fa-check"></i><b>9.4</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="spatial-data.html"><a href="spatial-data.html"><i class="fa fa-check"></i><b>10</b> Spatial data</a></li>
<li class="chapter" data-level="11" data-path="networks.html"><a href="networks.html"><i class="fa fa-check"></i><b>11</b> Networks</a>
<ul>
<li class="chapter" data-level="11.1" data-path="networks.html"><a href="networks.html#example-madmen"><i class="fa fa-check"></i><b>11.1</b> Example: Madmen</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="networks.html"><a href="networks.html#generate-a-network-view"><i class="fa fa-check"></i><b>11.1.1</b> Generate a network view</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="networks.html"><a href="networks.html#example-american-college-football"><i class="fa fa-check"></i><b>11.2</b> Example: American college football</a></li>
<li class="chapter" data-level="11.3" data-path="networks.html"><a href="networks.html#example-harry-potter-characters"><i class="fa fa-check"></i><b>11.3</b> Example: Harry Potter characters</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="variation-and-inference.html"><a href="variation-and-inference.html"><i class="fa fa-check"></i><b>12</b> Variation and inference</a>
<ul>
<li class="chapter" data-level="12.1" data-path="variation-and-inference.html"><a href="variation-and-inference.html#what-is-variation-and-uncertainty"><i class="fa fa-check"></i><b>12.1</b> What is variation and uncertainty?</a></li>
<li class="chapter" data-level="12.2" data-path="variation-and-inference.html"><a href="variation-and-inference.html#ways-of-sampling-the-data"><i class="fa fa-check"></i><b>12.2</b> Ways of sampling the data</a></li>
<li class="chapter" data-level="12.3" data-path="variation-and-inference.html"><a href="variation-and-inference.html#what-is-inference"><i class="fa fa-check"></i><b>12.3</b> What is inference?</a></li>
<li class="chapter" data-level="12.4" data-path="variation-and-inference.html"><a href="variation-and-inference.html#collecting-data"><i class="fa fa-check"></i><b>12.4</b> Collecting data</a></li>
<li class="chapter" data-level="12.5" data-path="variation-and-inference.html"><a href="variation-and-inference.html#randomization-tests"><i class="fa fa-check"></i><b>12.5</b> Randomization tests</a></li>
<li class="chapter" data-level="12.6" data-path="variation-and-inference.html"><a href="variation-and-inference.html#visual-inference"><i class="fa fa-check"></i><b>12.6</b> Visual inference</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="statistical-distributions.html"><a href="statistical-distributions.html"><i class="fa fa-check"></i><b>13</b> Statistical distributions</a></li>
<li class="chapter" data-level="14" data-path="randomization-methods.html"><a href="randomization-methods.html"><i class="fa fa-check"></i><b>14</b> Randomization methods</a></li>
<li class="chapter" data-level="15" data-path="variation-and-inference-1.html"><a href="variation-and-inference-1.html"><i class="fa fa-check"></i><b>15</b> Variation and inference</a></li>
<li class="chapter" data-level="16" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html"><i class="fa fa-check"></i><b>16</b> Model fitting and optimisation</a>
<ul>
<li class="chapter" data-level="16.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#overview-3"><i class="fa fa-check"></i><b>16.1</b> Overview</a></li>
<li class="chapter" data-level="16.2" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#why-models"><i class="fa fa-check"></i><b>16.2</b> Why models?</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#example"><i class="fa fa-check"></i><b>16.2.1</b> Example</a></li>
<li class="chapter" data-level="16.2.2" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#model-families"><i class="fa fa-check"></i><b>16.2.2</b> Model families</a></li>
<li class="chapter" data-level="16.2.3" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#your-turn-15"><i class="fa fa-check"></i><b>16.2.3</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#linear-models"><i class="fa fa-check"></i><b>16.3</b> Linear models</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#correlation-vs-linear-model"><i class="fa fa-check"></i><b>16.3.1</b> Correlation vs linear model</a></li>
<li class="chapter" data-level="16.3.2" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#correlation"><i class="fa fa-check"></i><b>16.3.2</b> Correlation</a></li>
<li class="chapter" data-level="16.3.3" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#simple-regression"><i class="fa fa-check"></i><b>16.3.3</b> Simple regression</a></li>
<li class="chapter" data-level="16.3.4" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#multiple-regression-model"><i class="fa fa-check"></i><b>16.3.4</b> Multiple regression model</a></li>
<li class="chapter" data-level="16.3.5" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#what-a-model-says"><i class="fa fa-check"></i><b>16.3.5</b> What a model says</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#lets-fit-a-model-to-co2"><i class="fa fa-check"></i><b>16.4</b> Let’s fit a model to CO2</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#try-a-linear-fit"><i class="fa fa-check"></i><b>16.4.1</b> Try a linear fit</a></li>
<li class="chapter" data-level="16.4.2" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#predict-from-the-model"><i class="fa fa-check"></i><b>16.4.2</b> Predict from the model</a></li>
<li class="chapter" data-level="16.4.3" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#plot-the-model"><i class="fa fa-check"></i><b>16.4.3</b> Plot the model</a></li>
<li class="chapter" data-level="16.4.4" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#examine-residuals"><i class="fa fa-check"></i><b>16.4.4</b> Examine residuals</a></li>
<li class="chapter" data-level="16.4.5" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#assessment-of-fit"><i class="fa fa-check"></i><b>16.4.5</b> Assessment of fit</a></li>
<li class="chapter" data-level="16.4.6" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#your-turn-16"><i class="fa fa-check"></i><b>16.4.6</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#model-basics-in-r"><i class="fa fa-check"></i><b>16.5</b> Model basics in R</a></li>
<li class="chapter" data-level="16.6" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#seasonality"><i class="fa fa-check"></i><b>16.6</b> Seasonality</a>
<ul>
<li class="chapter" data-level="16.6.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#your-turn-17"><i class="fa fa-check"></i><b>16.6.1</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="16.7" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#predict-co2-at-another-location"><i class="fa fa-check"></i><b>16.7</b> Predict co2 at another location</a>
<ul>
<li class="chapter" data-level="16.7.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#your-turn-18"><i class="fa fa-check"></i><b>16.7.1</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="16.8" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#using-optimisation-to-get-a-good-fit"><i class="fa fa-check"></i><b>16.8</b> Using optimisation to get a good fit</a>
<ul>
<li class="chapter" data-level="16.8.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#typical-distances"><i class="fa fa-check"></i><b>16.8.1</b> Typical distances</a></li>
<li class="chapter" data-level="16.8.2" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#your-turn-19"><i class="fa fa-check"></i><b>16.8.2</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="16.9" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#components-of-variation"><i class="fa fa-check"></i><b>16.9</b> Components of variation</a></li>
<li class="chapter" data-level="16.10" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#model-goodness-of-fit-statistics"><i class="fa fa-check"></i><b>16.10</b> Model goodness of fit statistics</a>
<ul>
<li class="chapter" data-level="16.10.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#your-turn-20"><i class="fa fa-check"></i><b>16.10.1</b> Your turn:</a></li>
</ul></li>
<li class="chapter" data-level="16.11" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#beyond-a-single-model"><i class="fa fa-check"></i><b>16.11</b> Beyond a single model</a></li>
<li class="chapter" data-level="16.12" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#gapminder"><i class="fa fa-check"></i><b>16.12</b> Gapminder</a>
<ul>
<li class="chapter" data-level="16.12.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#r-package"><i class="fa fa-check"></i><b>16.12.1</b> R package</a></li>
</ul></li>
<li class="chapter" data-level="16.13" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#fit-linear-models"><i class="fa fa-check"></i><b>16.13</b> Fit linear models</a>
<ul>
<li class="chapter" data-level="16.13.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#mutate-year"><i class="fa fa-check"></i><b>16.13.1</b> Mutate year</a></li>
</ul></li>
<li class="chapter" data-level="16.14" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#australia"><i class="fa fa-check"></i><b>16.14</b> Australia</a></li>
<li class="chapter" data-level="16.15" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#fit-all-countries"><i class="fa fa-check"></i><b>16.15</b> Fit all countries</a>
<ul>
<li class="chapter" data-level="16.15.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#five-minute-challenge"><i class="fa fa-check"></i><b>16.15.1</b> Five minute challenge</a></li>
<li class="chapter" data-level="16.15.2" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#plot-all-the-models"><i class="fa fa-check"></i><b>16.15.2</b> Plot all the models</a></li>
<li class="chapter" data-level="16.15.3" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#plot-all-the-model-coefficients"><i class="fa fa-check"></i><b>16.15.3</b> Plot all the model coefficients</a></li>
</ul></li>
<li class="chapter" data-level="16.16" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#model-diagnostics-by-country"><i class="fa fa-check"></i><b>16.16</b> Model diagnostics by country</a>
<ul>
<li class="chapter" data-level="16.16.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#plot-the-r2-values-as-a-histogram."><i class="fa fa-check"></i><b>16.16.1</b> Plot the <span class="math inline">\(R^2\)</span> values as a histogram.</a></li>
<li class="chapter" data-level="16.16.2" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#countries-with-worst-fit"><i class="fa fa-check"></i><b>16.16.2</b> Countries with worst fit</a></li>
<li class="chapter" data-level="16.16.3" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#five-minute-challenge-1"><i class="fa fa-check"></i><b>16.16.3</b> Five minute challenge</a></li>
</ul></li>
<li class="chapter" data-level="16.17" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#lab-exercise"><i class="fa fa-check"></i><b>16.17</b> Lab exercise</a></li>
<li class="chapter" data-level="16.18" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#transformations"><i class="fa fa-check"></i><b>16.18</b> Transformations</a>
<ul>
<li class="chapter" data-level="16.18.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#power-transformation"><i class="fa fa-check"></i><b>16.18.1</b> Power transformation</a></li>
<li class="chapter" data-level="16.18.2" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#transforming-categorical-variables"><i class="fa fa-check"></i><b>16.18.2</b> Transforming categorical variables</a></li>
</ul></li>
<li class="chapter" data-level="16.19" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#adding-interactions-to-the-model"><i class="fa fa-check"></i><b>16.19</b> Adding interactions to the model</a>
<ul>
<li class="chapter" data-level="16.19.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#interaction-between-quantitative-and-categorical-variables"><i class="fa fa-check"></i><b>16.19.1</b> Interaction between quantitative and categorical variables</a></li>
<li class="chapter" data-level="16.19.2" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#five-minute-challenge-2"><i class="fa fa-check"></i><b>16.19.2</b> Five minute challenge</a></li>
<li class="chapter" data-level="16.19.3" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#which-is-the-better-model"><i class="fa fa-check"></i><b>16.19.3</b> Which is the better model?</a></li>
<li class="chapter" data-level="16.19.4" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#interaction-between-quantitative-variables"><i class="fa fa-check"></i><b>16.19.4</b> Interaction between quantitative variables</a></li>
<li class="chapter" data-level="16.19.5" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#five-minute-challenge-3"><i class="fa fa-check"></i><b>16.19.5</b> Five minute challenge</a></li>
</ul></li>
<li class="chapter" data-level="16.20" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#model-building"><i class="fa fa-check"></i><b>16.20</b> Model building</a>
<ul>
<li class="chapter" data-level="16.20.1" data-path="model-fitting-and-optimisation.html"><a href="model-fitting-and-optimisation.html#lab-exercise-1"><i class="fa fa-check"></i><b>16.20.1</b> Lab exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="generalied-linear-models.html"><a href="generalied-linear-models.html"><i class="fa fa-check"></i><b>17</b> Generalied linear models</a></li>
<li class="chapter" data-level="18" data-path="hierarchical-models.html"><a href="hierarchical-models.html"><i class="fa fa-check"></i><b>18</b> Hierarchical models</a></li>
<li class="chapter" data-level="19" data-path="ensembles-of-models.html"><a href="ensembles-of-models.html"><i class="fa fa-check"></i><b>19</b> Ensembles of models</a></li>
<li class="chapter" data-level="20" data-path="boosted-models.html"><a href="boosted-models.html"><i class="fa fa-check"></i><b>20</b> Boosted models</a></li>
<li class="chapter" data-level="21" data-path="bayesian-models.html"><a href="bayesian-models.html"><i class="fa fa-check"></i><b>21</b> Bayesian models</a></li>
<li class="chapter" data-level="22" data-path="decision-making-with-data.html"><a href="decision-making-with-data.html"><i class="fa fa-check"></i><b>22</b> Decision making with data</a></li>
<li class="chapter" data-level="23" data-path="us-flights.html"><a href="us-flights.html"><i class="fa fa-check"></i><b>23</b> US flights</a>
<ul>
<li class="chapter" data-level="23.1" data-path="us-flights.html"><a href="us-flights.html#flight-delays"><i class="fa fa-check"></i><b>23.1</b> Flight delays</a>
<ul>
<li class="chapter" data-level="23.1.1" data-path="us-flights.html"><a href="us-flights.html#cancellations"><i class="fa fa-check"></i><b>23.1.1</b> Cancellations?</a></li>
<li class="chapter" data-level="23.1.2" data-path="us-flights.html"><a href="us-flights.html#fuel"><i class="fa fa-check"></i><b>23.1.2</b> Fuel</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="24" data-path="climate-change.html"><a href="climate-change.html"><i class="fa fa-check"></i><b>24</b> Climate change</a>
<ul>
<li class="chapter" data-level="24.1" data-path="climate-change.html"><a href="climate-change.html#carbon-dioxide"><i class="fa fa-check"></i><b>24.1</b> Carbon dioxide</a>
<ul>
<li class="chapter" data-level="24.1.1" data-path="climate-change.html"><a href="climate-change.html#about-the-data"><i class="fa fa-check"></i><b>24.1.1</b> About the data</a></li>
<li class="chapter" data-level="24.1.2" data-path="climate-change.html"><a href="climate-change.html#temporal-trend"><i class="fa fa-check"></i><b>24.1.2</b> Temporal trend</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="25" data-path="accidents.html"><a href="accidents.html"><i class="fa fa-check"></i><b>25</b> Accidents</a>
<ul>
<li class="chapter" data-level="25.1" data-path="accidents.html"><a href="accidents.html#when-do-people-die-on-the-roads"><i class="fa fa-check"></i><b>25.1</b> When do people die on the roads?</a></li>
<li class="chapter" data-level="25.2" data-path="accidents.html"><a href="accidents.html#what-contributes-to-fatal-accidents"><i class="fa fa-check"></i><b>25.2</b> What contributes to fatal accidents?</a></li>
<li class="chapter" data-level="25.3" data-path="accidents.html"><a href="accidents.html#who-is-involved-in-fatal-accidents"><i class="fa fa-check"></i><b>25.3</b> Who is involved in fatal accidents?</a></li>
<li class="chapter" data-level="25.4" data-path="accidents.html"><a href="accidents.html#are-roads-getting-safer"><i class="fa fa-check"></i><b>25.4</b> Are roads getting safer?</a></li>
<li class="chapter" data-level="25.5" data-path="accidents.html"><a href="accidents.html#your-turn-21"><i class="fa fa-check"></i><b>25.5</b> Your Turn</a></li>
<li class="chapter" data-level="25.6" data-path="accidents.html"><a href="accidents.html#solutions"><i class="fa fa-check"></i><b>25.6</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="monitoring-polls.html"><a href="monitoring-polls.html"><i class="fa fa-check"></i><b>26</b> Monitoring polls</a></li>
<li class="chapter" data-level="27" data-path="vandalism.html"><a href="vandalism.html"><i class="fa fa-check"></i><b>27</b> Vandalism</a></li>
<li class="chapter" data-level="28" data-path="pisa-programme-for-international-student-assessment.html"><a href="pisa-programme-for-international-student-assessment.html"><i class="fa fa-check"></i><b>28</b> PISA: Programme for International Student Assessment</a>
<ul>
<li class="chapter" data-level="28.1" data-path="pisa-programme-for-international-student-assessment.html"><a href="pisa-programme-for-international-student-assessment.html#data-access"><i class="fa fa-check"></i><b>28.1</b> Data access</a></li>
<li class="chapter" data-level="28.2" data-path="pisa-programme-for-international-student-assessment.html"><a href="pisa-programme-for-international-student-assessment.html#data-pre-processing"><i class="fa fa-check"></i><b>28.2</b> Data pre-processing</a></li>
<li class="chapter" data-level="28.3" data-path="pisa-programme-for-international-student-assessment.html"><a href="pisa-programme-for-international-student-assessment.html#examining-the-gender-gap-across-countries"><i class="fa fa-check"></i><b>28.3</b> Examining the gender gap across countries</a>
<ul>
<li class="chapter" data-level="28.3.1" data-path="pisa-programme-for-international-student-assessment.html"><a href="pisa-programme-for-international-student-assessment.html#clean-up-country-codes"><i class="fa fa-check"></i><b>28.3.1</b> Clean up country codes</a></li>
<li class="chapter" data-level="28.3.2" data-path="pisa-programme-for-international-student-assessment.html"><a href="pisa-programme-for-international-student-assessment.html#compute-weighted-means-by-country-and-gender"><i class="fa fa-check"></i><b>28.3.2</b> Compute weighted means by country and gender</a></li>
<li class="chapter" data-level="28.3.3" data-path="pisa-programme-for-international-student-assessment.html"><a href="pisa-programme-for-international-student-assessment.html#examine-the-math-gap-by-country"><i class="fa fa-check"></i><b>28.3.3</b> Examine the math gap by country</a></li>
<li class="chapter" data-level="28.3.4" data-path="pisa-programme-for-international-student-assessment.html"><a href="pisa-programme-for-international-student-assessment.html#what-we-learn"><i class="fa fa-check"></i><b>28.3.4</b> What we learn</a></li>
</ul></li>
<li class="chapter" data-level="28.4" data-path="pisa-programme-for-international-student-assessment.html"><a href="pisa-programme-for-international-student-assessment.html#your-turn-22"><i class="fa fa-check"></i><b>28.4</b> Your turn</a></li>
<li class="chapter" data-level="28.5" data-path="pisa-programme-for-international-student-assessment.html"><a href="pisa-programme-for-international-student-assessment.html#mapping-the-scores"><i class="fa fa-check"></i><b>28.5</b> Mapping the scores</a></li>
<li class="chapter" data-level="28.6" data-path="pisa-programme-for-international-student-assessment.html"><a href="pisa-programme-for-international-student-assessment.html#your-turn-23"><i class="fa fa-check"></i><b>28.6</b> Your turn</a></li>
<li class="chapter" data-level="28.7" data-path="pisa-programme-for-international-student-assessment.html"><a href="pisa-programme-for-international-student-assessment.html#change-in-scores-over-time"><i class="fa fa-check"></i><b>28.7</b> Change in scores over time</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="wages.html"><a href="wages.html"><i class="fa fa-check"></i><b>29</b> Wages</a>
<ul>
<li class="chapter" data-level="29.1" data-path="wages.html"><a href="wages.html#new-wages-data"><i class="fa fa-check"></i><b>29.1</b> New wages data</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="pedestrian-counting-sensor-data.html"><a href="pedestrian-counting-sensor-data.html"><i class="fa fa-check"></i><b>30</b> Pedestrian counting sensor data</a>
<ul>
<li class="chapter" data-level="30.1" data-path="pedestrian-counting-sensor-data.html"><a href="pedestrian-counting-sensor-data.html#overview-4"><i class="fa fa-check"></i><b>30.1</b> Overview</a></li>
<li class="chapter" data-level="30.2" data-path="pedestrian-counting-sensor-data.html"><a href="pedestrian-counting-sensor-data.html#different-temporal-patterns"><i class="fa fa-check"></i><b>30.2</b> Different temporal patterns</a></li>
<li class="chapter" data-level="30.3" data-path="pedestrian-counting-sensor-data.html"><a href="pedestrian-counting-sensor-data.html#does-the-weather-make-a-difference-to-the-number-of-people-walking-out"><i class="fa fa-check"></i><b>30.3</b> Does the weather make a difference to the number of people walking out?</a></li>
<li class="chapter" data-level="30.4" data-path="pedestrian-counting-sensor-data.html"><a href="pedestrian-counting-sensor-data.html#if-setting-up-a-coffee-business"><i class="fa fa-check"></i><b>30.4</b> If setting up a coffee business</a></li>
<li class="chapter" data-level="30.5" data-path="pedestrian-counting-sensor-data.html"><a href="pedestrian-counting-sensor-data.html#your-turn-24"><i class="fa fa-check"></i><b>30.5</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="31" data-path="government-surveys.html"><a href="government-surveys.html"><i class="fa fa-check"></i><b>31</b> Government surveys</a></li>
<li class="chapter" data-level="32" data-path="reproducible-documents.html"><a href="reproducible-documents.html"><i class="fa fa-check"></i><b>32</b> Reproducible documents</a></li>
<li class="chapter" data-level="33" data-path="collaborative-projects.html"><a href="collaborative-projects.html"><i class="fa fa-check"></i><b>33</b> Collaborative projects</a></li>
<li class="chapter" data-level="34" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>34</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/heike/data-technologies" target="blank">Published with Github.</a></li>
<li><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science and Statistical Thinking: With Wild-Caught Data and R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-fitting-and-optimisation" class="section level1 hasAnchor" number="16">
<h1><span class="header-section-number">Chapter 16</span> Model fitting and optimisation<a href="model-fitting-and-optimisation.html#model-fitting-and-optimisation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!--
This chapter has these topics

- Basic optimisation methods
- Least squares, LAD
- Linear models
- Decision trees
-->
<div id="overview-3" class="section level2 hasAnchor" number="16.1">
<h2><span class="header-section-number">16.1</span> Overview<a href="model-fitting-and-optimisation.html#overview-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Why models?</li>
<li>Linear models and correlation</li>
<li>Model fit, and predictions</li>
<li>Model basics in R</li>
<li>Optimisation for model fitting</li>
<li>Components of variation</li>
<li>Model goodness of fit statistics</li>
<li>Beyond a single model</li>
<li>Fitting many models</li>
<li>Transformations: building on a stable platform</li>
<li>Adding interactions to the model - what does this mean?</li>
<li>Model building - how do you decide when you’ve got the bets possible model?</li>
</ul>
<p><img src="images/magnifyingglass.jpg" />
Image source: Anton Croos <a href="https://art-of-photography-com.blogspot.com/">Art of Photography</a></p>
</div>
<div id="why-models" class="section level2 hasAnchor" number="16.2">
<h2><span class="header-section-number">16.2</span> Why models?<a href="model-fitting-and-optimisation.html#why-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>a simple low-dimensional summary of a dataset</li>
<li><strong>family of models</strong> express a relationship between different variables.</li>
<li>allows us to predict outcomes of interest, given other variables!</li>
<li><strong>prediction</strong> is critical in many fields</li>
</ul>
<div id="example" class="section level3 hasAnchor" number="16.2.1">
<h3><span class="header-section-number">16.2.1</span> Example<a href="model-fitting-and-optimisation.html#example" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><img src="book_files/figure-html/wind-1.png" width="768" style="display: block; margin: auto;" /></p>
<p><img src="images/LGA_Airport_diagram.pdf.jpg" /></p>
</div>
<div id="model-families" class="section level3 hasAnchor" number="16.2.2">
<h3><span class="header-section-number">16.2.2</span> Model families<a href="model-fitting-and-optimisation.html#model-families" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>A <strong>model family</strong> is the functional form that describes a relationship between an outcome <span class="math inline">\((Y)\)</span> and an input, covariate, pre-determined variable <span class="math inline">\((X)\)</span>, e.g.
<ul>
<li><span class="math inline">\(f(X)=b_0 + b_1 X +b_2 X^2+...+b_p X^p\)</span></li>
<li><span class="math inline">\(f(X)=b_0\exp(b_1X)\)</span></li>
<li><span class="math inline">\(f(X_1, X_2)=b_0 + b_1 X_1 + b_2 X_1^2 + b_3 X_2\)</span></li>
</ul></li>
<li>The <strong>fitted model</strong> makes this explicit (<span class="math inline">\(e\)</span> is the residual)
<ul>
<li><span class="math inline">\(y_i = 2+3x_i+x_i^2-2x_i^3+e_i, i=1, ...., n\)</span> <strong>or</strong> <span class="math inline">\(\widehat{y}=2+3x+x^2-2x^3\)</span></li>
<li><span class="math inline">\(y_i=3\exp(2x_i)+e_i\)</span> <strong>or</strong> <span class="math inline">\(\widehat{y}=3\exp(2x)\)</span></li>
<li><span class="math inline">\(y_i=-5 + 4 x_{i1} - 2 x_{i1}^2 + 10x_{i2}+e_i\)</span> <strong>or</strong> <span class="math inline">\(\widehat{y}=-5 + 4 x- 2 x^2+ 10x\)</span></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="model-fitting-and-optimisation.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb183-2"><a href="model-fitting-and-optimisation.html#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb183-3"><a href="model-fitting-and-optimisation.html#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This sets the domain of the function to be -1, 1</span></span>
<span id="cb183-4"><a href="model-fitting-and-optimisation.html#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="co"># and randomly generates values in this domain</span></span>
<span id="cb183-5"><a href="model-fitting-and-optimisation.html#cb183-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">100</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb183-6"><a href="model-fitting-and-optimisation.html#cb183-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(x, <span class="at">y=</span><span class="dv">2</span><span class="sc">+</span><span class="dv">3</span><span class="sc">*</span>x<span class="sc">+</span>x<span class="sc">^</span><span class="dv">2-2</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">3</span><span class="sc">+</span><span class="fu">rnorm</span>(<span class="dv">100</span>)<span class="sc">*</span><span class="fl">0.2</span>)</span>
<span id="cb183-7"><a href="model-fitting-and-optimisation.html#cb183-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb183-8"><a href="model-fitting-and-optimisation.html#cb183-8" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(x, <span class="at">y=</span><span class="dv">3</span><span class="sc">*</span><span class="fu">exp</span>(<span class="dv">2</span><span class="sc">*</span>x)<span class="sc">+</span><span class="fu">rnorm</span>(<span class="dv">100</span>)<span class="sc">*</span><span class="fl">0.5</span>)</span>
<span id="cb183-9"><a href="model-fitting-and-optimisation.html#cb183-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb183-10"><a href="model-fitting-and-optimisation.html#cb183-10" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">200</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb183-11"><a href="model-fitting-and-optimisation.html#cb183-11" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">200</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb183-12"><a href="model-fitting-and-optimisation.html#cb183-12" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(x1, x2, <span class="at">y=</span><span class="sc">-</span><span class="dv">5</span><span class="sc">+</span><span class="dv">4</span><span class="sc">*</span>x1<span class="dv">-2</span><span class="sc">*</span>x1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span><span class="dv">10</span><span class="sc">*</span>x2<span class="sc">+</span><span class="fu">rnorm</span>(<span class="dv">200</span>)<span class="sc">*</span><span class="fl">0.1</span>)</span>
<span id="cb183-13"><a href="model-fitting-and-optimisation.html#cb183-13" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">colour=</span>y)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span>
<span id="cb183-14"><a href="model-fitting-and-optimisation.html#cb183-14" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/diffcorr-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="your-turn-15" class="section level3 hasAnchor" number="16.2.3">
<h3><span class="header-section-number">16.2.3</span> Your turn<a href="model-fitting-and-optimisation.html#your-turn-15" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Try the sample code to generate data with different functional forms</li>
<li>Change the domain of the explanatory variable, and see what happens to the shape of the data</li>
<li>Make up some new functions, and simulate some samples</li>
</ul>
</div>
</div>
<div id="linear-models" class="section level2 hasAnchor" number="16.3">
<h2><span class="header-section-number">16.3</span> Linear models<a href="model-fitting-and-optimisation.html#linear-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="correlation-vs-linear-model" class="section level3 hasAnchor" number="16.3.1">
<h3><span class="header-section-number">16.3.1</span> Correlation vs linear model<a href="model-fitting-and-optimisation.html#correlation-vs-linear-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Linear association between two variables can be described by correlation, but</li>
<li>a multiple regression model can describe linear relationship between a response variable and many explanatory variables.</li>
</ul>
<p>For two variables <span class="math inline">\(X, Y\)</span>, correlation is:</p>
<p><span class="math display">\[r=\frac{\sum_{i=1}^{n} (x_i-\bar{x})(y_i-\bar{y})}{\sqrt{\sum_{i=1}^{n}(x_i-\bar{x})^2}\sqrt{\sum_{i=1}^{n}(y_i-\bar{y})^2}} = \frac{cov(X,Y)}{s_xs_y}\]</span></p>
</div>
<div id="correlation" class="section level3 hasAnchor" number="16.3.2">
<h3><span class="header-section-number">16.3.2</span> Correlation<a href="model-fitting-and-optimisation.html#correlation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><img src="book_files/figure-html/corrplot-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="simple-regression" class="section level3 hasAnchor" number="16.3.3">
<h3><span class="header-section-number">16.3.3</span> Simple regression<a href="model-fitting-and-optimisation.html#simple-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math display">\[y_i=\beta_0+\beta_1x_{i}+\varepsilon_i, ~~~ i=1, \dots, n\]</span></p>
<p>where (least squares) estimates for <span class="math inline">\(\beta_0, \beta_1\)</span> are:</p>
<p><span class="math display">\[b_1 = r\frac{s_y}{s_x}, ~~~~~~~~ b_0=\bar{y}-b_1\bar{x}\]</span></p>
<p>Slope is related to correlation, but it also depends on the
variation of observations, in both of the variables.</p>
<p><img src="book_files/figure-html/reg-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="multiple-regression-model" class="section level3 hasAnchor" number="16.3.4">
<h3><span class="header-section-number">16.3.4</span> Multiple regression model<a href="model-fitting-and-optimisation.html#multiple-regression-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math display">\[y_i=\beta_0+\beta_1x_{i1}+\dots +\beta_px_{ip}+\varepsilon_i, ~~~ i=1, \dots, n\]</span>
where <span class="math inline">\(\varepsilon\)</span> is a sample from a normal distribution, <span class="math inline">\(N(0, \sigma^2)\)</span>.</p>
</div>
<div id="what-a-model-says" class="section level3 hasAnchor" number="16.3.5">
<h3><span class="header-section-number">16.3.5</span> What a model says<a href="model-fitting-and-optimisation.html#what-a-model-says" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The fitted model allows us to predict a value for the response, e.g.
<ul>
<li>Suppose <span class="math inline">\(\widehat{y}=2+3x+x^2-2x^3\)</span>, then for <span class="math inline">\(x=0.5, \widehat{y}=2+3*0.5+0.5^2-2*0.5^3=3.5\)</span></li>
<li>Suppose <span class="math inline">\(\widehat{y}=3\exp(2x)\)</span>, then for <span class="math inline">\(x=-1, \widehat{y}=3\exp(2*(-1))=0.406\)</span></li>
</ul></li>
<li>How useful the model prediction is depends on the residual error. If the model explains little of the relationship then the residual error will be large and predictions less useful.</li>
<li>Predictions within the domain of the explanatory variables used to fit the model will be more reliable than <strong>extrapolating</strong> outside the domain. Particularly this is true for nonlinear models.</li>
</ul>
</div>
</div>
<div id="lets-fit-a-model-to-co2" class="section level2 hasAnchor" number="16.4">
<h2><span class="header-section-number">16.4</span> Let’s fit a model to CO2<a href="model-fitting-and-optimisation.html#lets-fit-a-model-to-co2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="model-fitting-and-optimisation.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb184-2"><a href="model-fitting-and-optimisation.html#cb184-2" aria-hidden="true" tabindex="-1"></a>CO2.spo <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://scrippsco2.ucsd.edu/assets/data/atmospheric/stations/merged_in_situ_and_flask/daily/daily_merge_co2_spo.csv&quot;</span>, <span class="at">col_names=</span><span class="fu">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;decdate&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;flg&quot;</span>, <span class="st">&quot;co2&quot;</span>), <span class="at">skip=</span><span class="dv">71</span>) <span class="sc">%&gt;%</span></span>
<span id="cb184-3"><a href="model-fitting-and-optimisation.html#cb184-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lat =</span> <span class="sc">-</span><span class="fl">90.0</span>, <span class="at">lon =</span> <span class="dv">0</span>, <span class="at">stn =</span> <span class="st">&quot;spo&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb184-4"><a href="model-fitting-and-optimisation.html#cb184-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(flg<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb184-5"><a href="model-fitting-and-optimisation.html#cb184-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ymd</span>(date))</span>
<span id="cb184-6"><a href="model-fitting-and-optimisation.html#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(CO2.spo, <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>co2)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="book_files/figure-html/CO2read-1.png" width="768" style="display: block; margin: auto;" /></p>
<div id="try-a-linear-fit" class="section level3 hasAnchor" number="16.4.1">
<h3><span class="header-section-number">16.4.1</span> Try a linear fit<a href="model-fitting-and-optimisation.html#try-a-linear-fit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="model-fitting-and-optimisation.html#cb185-1" aria-hidden="true" tabindex="-1"></a>CO2.spo</span>
<span id="cb185-2"><a href="model-fitting-and-optimisation.html#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 1,271 × 10</span></span>
<span id="cb185-3"><a href="model-fitting-and-optimisation.html#cb185-3" aria-hidden="true" tabindex="-1"></a>   date       time      day decdate     n   flg   co2   lat   lon stn  </span>
<span id="cb185-4"><a href="model-fitting-and-optimisation.html#cb185-4" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>date<span class="sc">&gt;</span>     <span class="er">&lt;</span>time<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span></span>
<span id="cb185-5"><a href="model-fitting-and-optimisation.html#cb185-5" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span> <span class="dv">1957-06-17</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">00</span>  <span class="dv">20988</span>    <span class="fl">1957.</span>     <span class="dv">1</span>     <span class="dv">0</span>  <span class="fl">313.</span>   <span class="sc">-</span><span class="dv">90</span>     <span class="dv">0</span> spo  </span>
<span id="cb185-6"><a href="model-fitting-and-optimisation.html#cb185-6" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span> <span class="dv">1957-12-22</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">00</span>  <span class="dv">21176</span>    <span class="fl">1958.</span>     <span class="dv">1</span>     <span class="dv">0</span>  <span class="fl">314.</span>   <span class="sc">-</span><span class="dv">90</span>     <span class="dv">0</span> spo  </span>
<span id="cb185-7"><a href="model-fitting-and-optimisation.html#cb185-7" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span> <span class="dv">1957-12-23</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">00</span>  <span class="dv">21177</span>    <span class="fl">1958.</span>     <span class="dv">1</span>     <span class="dv">0</span>  <span class="fl">314.</span>   <span class="sc">-</span><span class="dv">90</span>     <span class="dv">0</span> spo  </span>
<span id="cb185-8"><a href="model-fitting-and-optimisation.html#cb185-8" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span> <span class="dv">1958-03-21</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">00</span>  <span class="dv">21265</span>    <span class="fl">1958.</span>     <span class="dv">1</span>     <span class="dv">0</span>  <span class="fl">314.</span>   <span class="sc">-</span><span class="dv">90</span>     <span class="dv">0</span> spo  </span>
<span id="cb185-9"><a href="model-fitting-and-optimisation.html#cb185-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span> <span class="dv">1958-03-22</span> <span class="dv">06</span><span class="sc">:</span><span class="dv">30</span>  <span class="fl">21266.</span>   <span class="fl">1958.</span>     <span class="dv">2</span>     <span class="dv">0</span>  <span class="fl">314.</span>   <span class="sc">-</span><span class="dv">90</span>     <span class="dv">0</span> spo  </span>
<span id="cb185-10"><a href="model-fitting-and-optimisation.html#cb185-10" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span> <span class="dv">1958-06-20</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">00</span>  <span class="dv">21356</span>    <span class="fl">1958.</span>     <span class="dv">1</span>     <span class="dv">0</span>  <span class="fl">315.</span>   <span class="sc">-</span><span class="dv">90</span>     <span class="dv">0</span> spo  </span>
<span id="cb185-11"><a href="model-fitting-and-optimisation.html#cb185-11" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span> <span class="dv">1958-09-27</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">00</span>  <span class="dv">21455</span>    <span class="fl">1959.</span>     <span class="dv">1</span>     <span class="dv">0</span>  <span class="fl">315.</span>   <span class="sc">-</span><span class="dv">90</span>     <span class="dv">0</span> spo  </span>
<span id="cb185-12"><a href="model-fitting-and-optimisation.html#cb185-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span> <span class="dv">1958-09-28</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">00</span>  <span class="dv">21456</span>    <span class="fl">1959.</span>     <span class="dv">1</span>     <span class="dv">0</span>  <span class="fl">315.</span>   <span class="sc">-</span><span class="dv">90</span>     <span class="dv">0</span> spo  </span>
<span id="cb185-13"><a href="model-fitting-and-optimisation.html#cb185-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span> <span class="dv">1959-01-08</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">00</span>  <span class="dv">21558</span>    <span class="fl">1959.</span>     <span class="dv">1</span>     <span class="dv">0</span>  <span class="fl">315.</span>   <span class="sc">-</span><span class="dv">90</span>     <span class="dv">0</span> spo  </span>
<span id="cb185-14"><a href="model-fitting-and-optimisation.html#cb185-14" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> <span class="dv">1959-01-12</span> <span class="dv">00</span><span class="sc">:</span><span class="dv">00</span>  <span class="dv">21562</span>    <span class="fl">1959.</span>     <span class="dv">1</span>     <span class="dv">0</span>  <span class="fl">315.</span>   <span class="sc">-</span><span class="dv">90</span>     <span class="dv">0</span> spo  </span>
<span id="cb185-15"><a href="model-fitting-and-optimisation.html#cb185-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ℹ 1,261 more rows</span></span></code></pre></div>
<ul>
<li>Use the <code>day</code> variable as the explanatory variable.</li>
<li>It needs to be re-scaled to start from 1 until the number of days in the time frame.</li>
<li>Subtract the number of the earliest day</li>
</ul>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="model-fitting-and-optimisation.html#cb186-1" aria-hidden="true" tabindex="-1"></a>CO2.spo <span class="ot">&lt;-</span> CO2.spo <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">day0=</span>day<span class="sc">-</span><span class="fu">min</span>(day))</span>
<span id="cb186-2"><a href="model-fitting-and-optimisation.html#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CO2.spo<span class="sc">$</span>day)</span>
<span id="cb186-3"><a href="model-fitting-and-optimisation.html#cb186-3" aria-hidden="true" tabindex="-1"></a>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span id="cb186-4"><a href="model-fitting-and-optimisation.html#cb186-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">20988</span>   <span class="dv">29153</span>   <span class="dv">34275</span>   <span class="dv">34190</span>   <span class="dv">39426</span>   <span class="dv">44593</span> </span>
<span id="cb186-5"><a href="model-fitting-and-optimisation.html#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CO2.spo<span class="sc">$</span>day0)</span>
<span id="cb186-6"><a href="model-fitting-and-optimisation.html#cb186-6" aria-hidden="true" tabindex="-1"></a>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span id="cb186-7"><a href="model-fitting-and-optimisation.html#cb186-7" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span>    <span class="dv">8165</span>   <span class="dv">13287</span>   <span class="dv">13202</span>   <span class="dv">18438</span>   <span class="dv">23605</span> </span></code></pre></div>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="model-fitting-and-optimisation.html#cb187-1" aria-hidden="true" tabindex="-1"></a>co2_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(co2<span class="sc">~</span>day0, <span class="at">data=</span>CO2.spo)</span>
<span id="cb187-2"><a href="model-fitting-and-optimisation.html#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb187-3"><a href="model-fitting-and-optimisation.html#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(co2_fit)</span>
<span id="cb187-4"><a href="model-fitting-and-optimisation.html#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 2 × 5</span></span>
<span id="cb187-5"><a href="model-fitting-and-optimisation.html#cb187-5" aria-hidden="true" tabindex="-1"></a>  term         estimate std.error statistic p.value</span>
<span id="cb187-6"><a href="model-fitting-and-optimisation.html#cb187-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>           <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb187-7"><a href="model-fitting-and-optimisation.html#cb187-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> (Intercept) <span class="fl">301.</span>      <span class="fl">0.245</span>         <span class="fl">1227.</span>       <span class="dv">0</span></span>
<span id="cb187-8"><a href="model-fitting-and-optimisation.html#cb187-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> day0          <span class="fl">0.00443</span> <span class="fl">0.0000169</span>      <span class="fl">262.</span>       <span class="dv">0</span></span>
<span id="cb187-9"><a href="model-fitting-and-optimisation.html#cb187-9" aria-hidden="true" tabindex="-1"></a>coef <span class="ot">&lt;-</span> <span class="fu">tidy</span>(co2_fit)<span class="sc">$</span>estimate</span></code></pre></div>
<p>Then the fitted model will be:</p>
<p><span class="math display">\[\widehat{co2}=302.636+0.00423\times day0\]</span></p>
</div>
<div id="predict-from-the-model" class="section level3 hasAnchor" number="16.4.2">
<h3><span class="header-section-number">16.4.2</span> Predict from the model<a href="model-fitting-and-optimisation.html#predict-from-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>For day0=10000</li>
<li>the model predicts co2 to be 300.7019389+0.0044274*10000 = 344.975937.</li>
</ul>
</div>
<div id="plot-the-model" class="section level3 hasAnchor" number="16.4.3">
<h3><span class="header-section-number">16.4.3</span> Plot the model<a href="model-fitting-and-optimisation.html#plot-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="model-fitting-and-optimisation.html#cb188-1" aria-hidden="true" tabindex="-1"></a>co2_model <span class="ot">&lt;-</span> <span class="fu">augment</span>(co2_fit, CO2.spo)</span>
<span id="cb188-2"><a href="model-fitting-and-optimisation.html#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(co2_model, <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>co2)) <span class="sc">+</span> </span>
<span id="cb188-3"><a href="model-fitting-and-optimisation.html#cb188-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb188-4"><a href="model-fitting-and-optimisation.html#cb188-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>.fitted), <span class="at">colour=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/CO2plot-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="examine-residuals" class="section level3 hasAnchor" number="16.4.4">
<h3><span class="header-section-number">16.4.4</span> Examine residuals<a href="model-fitting-and-optimisation.html#examine-residuals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>Residuals</strong> are calculated for each observed <span class="math inline">\(y\)</span> by computing the difference: <span class="math inline">\(y_i-\widehat{y_i}\)</span>.</li>
<li>Plotting the residuals against fitted values (or x in simple linear models) can reveal problems with the fit.</li>
</ul>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="model-fitting-and-optimisation.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(co2_model, <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>.std.resid)) <span class="sc">+</span> </span>
<span id="cb189-2"><a href="model-fitting-and-optimisation.html#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span></code></pre></div>
<p><img src="book_files/figure-html/CO2res-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="assessment-of-fit" class="section level3 hasAnchor" number="16.4.5">
<h3><span class="header-section-number">16.4.5</span> Assessment of fit<a href="model-fitting-and-optimisation.html#assessment-of-fit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The relationship between co2 and day0 is nonlinear!</li>
<li>The linear model does a reasonable job of explaining the increasing trend over time, but it especially mismatches the observed data at the ends, and middle of the time period.</li>
</ul>
</div>
<div id="your-turn-16" class="section level3 hasAnchor" number="16.4.6">
<h3><span class="header-section-number">16.4.6</span> Your turn<a href="model-fitting-and-optimisation.html#your-turn-16" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Try to add a quadratic term (in day0), or more, to the model to improve the fit.</li>
<li>Hints: (1) you may want to centre the day0 values, or even standardise them, to get a nice quadratic form, (2) If the fit is good, your residual vs fitted plot should have values evenly spread above and below 0, and relatively even across the time span.</li>
</ul>
</div>
</div>
<div id="model-basics-in-r" class="section level2 hasAnchor" number="16.5">
<h2><span class="header-section-number">16.5</span> Model basics in R<a href="model-fitting-and-optimisation.html#model-basics-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Formula
<ul>
<li><code>response ~ explanatory</code> specifies the reponse variable and explanatory variable from the data</li>
<li>e.g. <code>y ~ x1+x2+x3</code> three explanatory variables to be used to model response, main effects only</li>
<li><code>y ~ x1*x2*x3</code> include interaction terms</li>
<li><code>y ~ x - 1</code> specifies to force model to go through 0, that <span class="math inline">\(b_0\)</span> will be set to 0.</li>
</ul></li>
<li>Extract components using the broom package
<ul>
<li><code>tidy</code> extracts the coefficients</li>
<li><code>augment</code> extracts residuals and fitted values, and pointwise diagnostics</li>
<li><code>glance</code> extracts model fit summaries</li>
</ul></li>
</ul>
</div>
<div id="seasonality" class="section level2 hasAnchor" number="16.6">
<h2><span class="header-section-number">16.6</span> Seasonality<a href="model-fitting-and-optimisation.html#seasonality" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="your-turn-17" class="section level3 hasAnchor" number="16.6.1">
<h3><span class="header-section-number">16.6.1</span> Your turn<a href="model-fitting-and-optimisation.html#your-turn-17" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Below we have a plot the residuals on a short time frame, you can see that there is some seasonality. Values are high in spring, and low in autumn!</li>
<li>Brainstorm with your table members - yes, please talk with each other - ideas on how to fit a model that takes seasonality into account. There are multiple solutions, and maybe some that we haven’t thought of.</li>
</ul>
<p><img src="book_files/figure-html/CO2seas-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="predict-co2-at-another-location" class="section level2 hasAnchor" number="16.7">
<h2><span class="header-section-number">16.7</span> Predict co2 at another location<a href="model-fitting-and-optimisation.html#predict-co2-at-another-location" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="your-turn-18" class="section level3 hasAnchor" number="16.7.1">
<h3><span class="header-section-number">16.7.1</span> Your turn<a href="model-fitting-and-optimisation.html#your-turn-18" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Using your model, built using values collected the south pole sensor, see how well it fits values from Point Barrow, Alaska.</p>
<ol style="list-style-type: decimal">
<li>Download the data. You can use almost the same code as for SPO but check the file name at <a href="http://scrippsco2.ucsd.edu/data/atmospheric_co2/ptb" class="uri">http://scrippsco2.ucsd.edu/data/atmospheric_co2/ptb</a>.</li>
<li>The code below is a way to fit new data. It needs a bit of modification.</li>
</ol>
<pre><code>co2_model_ptb &lt;- augment(co2_fit2, newdata=CO2.ptb)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Plot the data, and overlay the fitted model. You can use code like this.</li>
</ol>
<pre><code>ggplot(co2_model, aes(x=date, y=co2)) + 
  geom_point() + 
  geom_line(aes(y=.fitted), colour=&quot;blue&quot;)</code></pre>
</div>
</div>
<div id="using-optimisation-to-get-a-good-fit" class="section level2 hasAnchor" number="16.8">
<h2><span class="header-section-number">16.8</span> Using optimisation to get a good fit<a href="model-fitting-and-optimisation.html#using-optimisation-to-get-a-good-fit" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>GOAL: Fitted model is close to all observed points</li>
<li>APPROACH: Measure the distance between the observed and fitted value, for each observation.</li>
<li>SOLUTION: Best model makes all these distances as small as possible</li>
</ul>
<div id="typical-distances" class="section level3 hasAnchor" number="16.8.1">
<h3><span class="header-section-number">16.8.1</span> Typical distances<a href="model-fitting-and-optimisation.html#typical-distances" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Squared: <span class="math inline">\(\sum_{i=1}^n (y_i - \widehat{y_i})^2\)</span> (Fit is called <strong>least squares fit</strong>)</li>
<li>Absolute: <span class="math inline">\(\sum_{i}|~y_i - \widehat{y_i}~|\)</span> (Fit called <strong>least absolute deviations</strong>)</li>
<li>Power <span class="math inline">\(p\)</span>: <span class="math inline">\(\sum_{i=1}^n (y_i - \widehat{y_i})^p\)</span> (<span class="math inline">\(p=2,4,6,... L_p\)</span> distance)</li>
</ul>
<p>Let’s take a look, for the examples from last lecture. Data is simulated from this model:</p>
<p><span class="math inline">\(\widehat{y}=2+3x+x^2-2x^3\)</span></p>
<p><img src="book_files/figure-html/opt-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>We know that <span class="math inline">\(\beta_0=2, \beta_1=3, \beta_2=1, \beta_3=-2\)</span>.</p>
<p>From the data, assume we DO NOT KNOW these parameter values, (<em>but that we do know the model family</em>) and we will estimate the parameters from the data provided. We need to find values for <span class="math inline">\(b_0, b_1, b_2, b_3\)</span> that minimise the distance between the resulting fitted value (<span class="math inline">\(\widehat{y}\)</span>) and the observed <span class="math inline">\(y\)</span>.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="model-fitting-and-optimisation.html#cb192-1" aria-hidden="true" tabindex="-1"></a>square_err <span class="ot">&lt;-</span> <span class="cf">function</span>(par, data) {</span>
<span id="cb192-2"><a href="model-fitting-and-optimisation.html#cb192-2" aria-hidden="true" tabindex="-1"></a>  sq <span class="ot">&lt;-</span> <span class="fu">sum</span>((data<span class="sc">$</span>y<span class="sc">-</span>(par[<span class="dv">1</span>]<span class="sc">+</span>par[<span class="dv">2</span>]<span class="sc">*</span>data<span class="sc">$</span>x<span class="sc">+</span>par[<span class="dv">3</span>]<span class="sc">*</span>data<span class="sc">$</span>x<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>par[<span class="dv">4</span>]<span class="sc">*</span>data<span class="sc">$</span>x<span class="sc">^</span><span class="dv">3</span>))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb192-3"><a href="model-fitting-and-optimisation.html#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sq)</span>
<span id="cb192-4"><a href="model-fitting-and-optimisation.html#cb192-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb192-5"><a href="model-fitting-and-optimisation.html#cb192-5" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), square_err, <span class="at">data=</span>df)</span>
<span id="cb192-6"><a href="model-fitting-and-optimisation.html#cb192-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">fitted =</span> fit<span class="sc">$</span>par[<span class="dv">1</span>] <span class="sc">+</span> fit<span class="sc">$</span>par[<span class="dv">2</span>]<span class="sc">*</span>x <span class="sc">+</span></span>
<span id="cb192-7"><a href="model-fitting-and-optimisation.html#cb192-7" aria-hidden="true" tabindex="-1"></a>                      fit<span class="sc">$</span>par[<span class="dv">3</span>]<span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> fit<span class="sc">$</span>par[<span class="dv">4</span>]<span class="sc">*</span>x<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb192-8"><a href="model-fitting-and-optimisation.html#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb192-9"><a href="model-fitting-and-optimisation.html#cb192-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>fitted), <span class="at">colour=</span><span class="st">&quot;blue&quot;</span>) </span></code></pre></div>
<p><img src="book_files/figure-html/loss-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="your-turn-19" class="section level3 hasAnchor" number="16.8.2">
<h3><span class="header-section-number">16.8.2</span> Your turn<a href="model-fitting-and-optimisation.html#your-turn-19" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Get my code to work for you. Your results might vary slightly from mine, because it is generating a different sample or data, and this might result in different parameter estimates</li>
<li>Write a function to compute least absolute deviation, and run the optimisation with this instead of least squares</li>
<li>Plot the data, least squares line, and the least absolute deviation model fits.</li>
</ol>
</div>
</div>
<div id="components-of-variation" class="section level2 hasAnchor" number="16.9">
<h2><span class="header-section-number">16.9</span> Components of variation<a href="model-fitting-and-optimisation.html#components-of-variation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>total variation: how much does Y vary, which is what we want to explain using the other variables</li>
<li>variation explained by the model</li>
<li>residual variation: what’s left over after fitting the model</li>
</ul>
<p>Open the app available at <a href="https://ebsmonash.shinyapps.io/SSregression/">https://ebsmonash.shinyapps.io/SSregression/</a>. (The original version was obtained from <a href="https://github.com/paternogbc/SSregression">https://github.com/paternogbc/SSregression</a>, developed by Gustavo Brant Paterno, a PhD student from Brazil.)</p>
<p>The app simulates some data using different slopes and error variance. It allows you to see how characteristics of the data affect model summaries. Time to play!</p>
<ol style="list-style-type: decimal">
<li>Vary the slope from high positive to zero. What happens to the error variance? The total variance and the regression variance (due to model)? Does the proportion of variation of each component change? How? Is this the same if you vary from large negative slope to zero?</li>
<li>Holding the slope fixed at 1, increase the standard deviation of the error model. What happens to components of variation?</li>
<li>As the slope changes, what happens to the intercept?</li>
<li>Why isn’t the estimated slope the same as what is set by the slider?</li>
</ol>
</div>
<div id="model-goodness-of-fit-statistics" class="section level2 hasAnchor" number="16.10">
<h2><span class="header-section-number">16.10</span> Model goodness of fit statistics<a href="model-fitting-and-optimisation.html#model-goodness-of-fit-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Simulate data again from this model:</p>
<p><span class="math inline">\(\widehat{y}=2+3x+x^2-2x^3\)</span></p>
<p>Then consider these two models:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(\widehat{y}=b_0+b_1x+b_2x^2\)</span></li>
<li><span class="math inline">\(\widehat{y}=b_0+b_1x+b_2x^2+b_3x^3\)</span></li>
</ol>
<p>Model 2 would be the correct family, because it matches how we generated the data. The model goodness of fit statistics should reflect this.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="model-fitting-and-optimisation.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb193-2"><a href="model-fitting-and-optimisation.html#cb193-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb193-3"><a href="model-fitting-and-optimisation.html#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x2=</span>x<span class="sc">^</span><span class="dv">2</span>, <span class="at">x3=</span>x<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb193-4"><a href="model-fitting-and-optimisation.html#cb193-4" aria-hidden="true" tabindex="-1"></a>df_mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x<span class="sc">+</span>x2, <span class="at">data=</span>df)</span>
<span id="cb193-5"><a href="model-fitting-and-optimisation.html#cb193-5" aria-hidden="true" tabindex="-1"></a>df_mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x<span class="sc">+</span>x2<span class="sc">+</span>x3, <span class="at">data=</span>df)</span>
<span id="cb193-6"><a href="model-fitting-and-optimisation.html#cb193-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(df_mod1)</span>
<span id="cb193-7"><a href="model-fitting-and-optimisation.html#cb193-7" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 1 × 12</span></span>
<span id="cb193-8"><a href="model-fitting-and-optimisation.html#cb193-8" aria-hidden="true" tabindex="-1"></a>  r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC</span>
<span id="cb193-9"><a href="model-fitting-and-optimisation.html#cb193-9" aria-hidden="true" tabindex="-1"></a>      <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>         <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb193-10"><a href="model-fitting-and-optimisation.html#cb193-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="fl">0.882</span>         <span class="fl">0.879</span> <span class="fl">0.390</span>      <span class="fl">361.</span> <span class="fl">1.16e-45</span>     <span class="dv">2</span>  <span class="sc">-</span><span class="fl">46.2</span>  <span class="fl">100.</span>  <span class="fl">111.</span></span>
<span id="cb193-11"><a href="model-fitting-and-optimisation.html#cb193-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</span></span>
<span id="cb193-12"><a href="model-fitting-and-optimisation.html#cb193-12" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(df_mod2)</span>
<span id="cb193-13"><a href="model-fitting-and-optimisation.html#cb193-13" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 1 × 12</span></span>
<span id="cb193-14"><a href="model-fitting-and-optimisation.html#cb193-14" aria-hidden="true" tabindex="-1"></a>  r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC</span>
<span id="cb193-15"><a href="model-fitting-and-optimisation.html#cb193-15" aria-hidden="true" tabindex="-1"></a>      <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>         <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb193-16"><a href="model-fitting-and-optimisation.html#cb193-16" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="fl">0.971</span>         <span class="fl">0.970</span> <span class="fl">0.195</span>     <span class="fl">1065.</span> <span class="fl">1.62e-73</span>     <span class="dv">3</span>   <span class="fl">23.9</span> <span class="sc">-</span><span class="fl">37.7</span> <span class="sc">-</span><span class="fl">24.7</span></span>
<span id="cb193-17"><a href="model-fitting-and-optimisation.html#cb193-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</span></span></code></pre></div>
<p>The statistics are:</p>
<ul>
<li><span class="math inline">\(R^2\)</span>: (model variance)/(total variance), the amount of variance in response explained by the model. Always ranges between 0 and 1, with 1 indicating a perfect fit. Adding more variables to the model will always increase <span class="math inline">\(R^2\)</span>, so what is important is how big an increase is gained. Adjusted <span class="math inline">\(R^2\)</span> reduces this for every additional variable added.</li>
<li>Deviance is the residual variation, how much variation in response that IS NOT explained by the model. The close to 0 the better, but it is not on a standard scale. In comparing two models if one has substantially lower deviance, then it is a better model.</li>
<li>Similarly BIC (Bayes Information Criterion) indicates how well the model fits, best used to compare two models. The lower is better.</li>
<li>df is the degrees of freedom left from the model fit. Starts at <span class="math inline">\(n\)</span> (sample size) and drops for each additional parameter estimated by the model.</li>
</ul>
<p>All of these statistics indicate the model 2 is substantially a better fit than model 1.</p>
<div id="your-turn-20" class="section level3 hasAnchor" number="16.10.1">
<h3><span class="header-section-number">16.10.1</span> Your turn:<a href="model-fitting-and-optimisation.html#your-turn-20" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>For the co2 model fitting from yesterday, examine the model fit statistics for the linear model vs the one with a quadratic term. What do they indicate is the better fit?</li>
<li>Try fitting the seasonal pattern with one of the ideas you came up with yesterday. Use the model fit statistics, and residual plots, to determine if the model is better than the quadratic model.</li>
</ul>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="model-fitting-and-optimisation.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb194-2"><a href="model-fitting-and-optimisation.html#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb194-3"><a href="model-fitting-and-optimisation.html#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb194-4"><a href="model-fitting-and-optimisation.html#cb194-4" aria-hidden="true" tabindex="-1"></a>CO2.spo <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://scrippsco2.ucsd.edu/assets/data/atmospheric/stations/merged_in_situ_and_flask/daily/daily_merge_co2_spo.csv&quot;</span>, <span class="at">col_names=</span><span class="fu">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;decdate&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;flg&quot;</span>, <span class="st">&quot;co2&quot;</span>), <span class="at">skip=</span><span class="dv">71</span>) <span class="sc">%&gt;%</span></span>
<span id="cb194-5"><a href="model-fitting-and-optimisation.html#cb194-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lat =</span> <span class="sc">-</span><span class="fl">90.0</span>, <span class="at">lon =</span> <span class="dv">0</span>, <span class="at">stn =</span> <span class="st">&quot;spo&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb194-6"><a href="model-fitting-and-optimisation.html#cb194-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(flg<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb194-7"><a href="model-fitting-and-optimisation.html#cb194-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ymd</span>(date))</span>
<span id="cb194-8"><a href="model-fitting-and-optimisation.html#cb194-8" aria-hidden="true" tabindex="-1"></a>CO2.spo <span class="ot">&lt;-</span> CO2.spo <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">day0=</span>day<span class="sc">-</span><span class="fu">min</span>(day))</span>
<span id="cb194-9"><a href="model-fitting-and-optimisation.html#cb194-9" aria-hidden="true" tabindex="-1"></a>co2_fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(co2<span class="sc">~</span>day0, <span class="at">data=</span>CO2.spo)</span>
<span id="cb194-10"><a href="model-fitting-and-optimisation.html#cb194-10" aria-hidden="true" tabindex="-1"></a>co2_fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(co2<span class="sc">~</span>day0<span class="sc">+</span><span class="fu">I</span>(day0<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span>CO2.spo)</span>
<span id="cb194-11"><a href="model-fitting-and-optimisation.html#cb194-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(co2_fit1)</span>
<span id="cb194-12"><a href="model-fitting-and-optimisation.html#cb194-12" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 1 × 12</span></span>
<span id="cb194-13"><a href="model-fitting-and-optimisation.html#cb194-13" aria-hidden="true" tabindex="-1"></a>  r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC</span>
<span id="cb194-14"><a href="model-fitting-and-optimisation.html#cb194-14" aria-hidden="true" tabindex="-1"></a>      <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>         <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb194-15"><a href="model-fitting-and-optimisation.html#cb194-15" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="fl">0.982</span>         <span class="fl">0.982</span>  <span class="fl">3.65</span>    <span class="fl">68871.</span>       <span class="dv">0</span>     <span class="dv">1</span> <span class="sc">-</span><span class="fl">3448.</span> <span class="fl">6901.</span> <span class="fl">6917.</span></span>
<span id="cb194-16"><a href="model-fitting-and-optimisation.html#cb194-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</span></span>
<span id="cb194-17"><a href="model-fitting-and-optimisation.html#cb194-17" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(co2_fit2)</span>
<span id="cb194-18"><a href="model-fitting-and-optimisation.html#cb194-18" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 1 × 12</span></span>
<span id="cb194-19"><a href="model-fitting-and-optimisation.html#cb194-19" aria-hidden="true" tabindex="-1"></a>  r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC</span>
<span id="cb194-20"><a href="model-fitting-and-optimisation.html#cb194-20" aria-hidden="true" tabindex="-1"></a>      <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>         <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb194-21"><a href="model-fitting-and-optimisation.html#cb194-21" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="fl">0.999</span>         <span class="fl">0.999</span> <span class="fl">0.800</span>   <span class="fl">728936.</span>       <span class="dv">0</span>     <span class="dv">2</span> <span class="sc">-</span><span class="fl">1518.</span> <span class="fl">3045.</span> <span class="fl">3065.</span></span>
<span id="cb194-22"><a href="model-fitting-and-optimisation.html#cb194-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</span></span>
<span id="cb194-23"><a href="model-fitting-and-optimisation.html#cb194-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb194-24"><a href="model-fitting-and-optimisation.html#cb194-24" aria-hidden="true" tabindex="-1"></a>CO2.spo <span class="ot">&lt;-</span> CO2.spo <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">month=</span><span class="fu">month</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">TRUE</span>))</span>
<span id="cb194-25"><a href="model-fitting-and-optimisation.html#cb194-25" aria-hidden="true" tabindex="-1"></a>co2_fit3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(co2<span class="sc">~</span>day0<span class="sc">+</span><span class="fu">I</span>(day0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>month, <span class="at">data=</span>CO2.spo)</span>
<span id="cb194-26"><a href="model-fitting-and-optimisation.html#cb194-26" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(co2_fit3)</span>
<span id="cb194-27"><a href="model-fitting-and-optimisation.html#cb194-27" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 1 × 12</span></span>
<span id="cb194-28"><a href="model-fitting-and-optimisation.html#cb194-28" aria-hidden="true" tabindex="-1"></a>  r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC</span>
<span id="cb194-29"><a href="model-fitting-and-optimisation.html#cb194-29" aria-hidden="true" tabindex="-1"></a>      <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>         <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb194-30"><a href="model-fitting-and-optimisation.html#cb194-30" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="fl">0.999</span>         <span class="fl">0.999</span> <span class="fl">0.691</span>   <span class="fl">150171.</span>       <span class="dv">0</span>    <span class="dv">13</span> <span class="sc">-</span><span class="fl">1327.</span> <span class="fl">2685.</span> <span class="fl">2762.</span></span>
<span id="cb194-31"><a href="model-fitting-and-optimisation.html#cb194-31" aria-hidden="true" tabindex="-1"></a><span class="co"># ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</span></span>
<span id="cb194-32"><a href="model-fitting-and-optimisation.html#cb194-32" aria-hidden="true" tabindex="-1"></a>co2_model3 <span class="ot">&lt;-</span> <span class="fu">augment</span>(co2_fit3, CO2.spo)</span>
<span id="cb194-33"><a href="model-fitting-and-optimisation.html#cb194-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(co2_model3, <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>co2)) <span class="sc">+</span> </span>
<span id="cb194-34"><a href="model-fitting-and-optimisation.html#cb194-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb194-35"><a href="model-fitting-and-optimisation.html#cb194-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>.fitted), <span class="at">colour=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/CO2gof-1.png" width="768" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="model-fitting-and-optimisation.html#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">filter</span>(co2_model3, <span class="fu">year</span>(date)<span class="sc">&gt;</span><span class="dv">1975</span>, <span class="fu">year</span>(date)<span class="sc">&lt;</span><span class="dv">1987</span>),</span>
<span id="cb195-2"><a href="model-fitting-and-optimisation.html#cb195-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>co2)) <span class="sc">+</span> </span>
<span id="cb195-3"><a href="model-fitting-and-optimisation.html#cb195-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb195-4"><a href="model-fitting-and-optimisation.html#cb195-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>.fitted), <span class="at">colour=</span><span class="st">&quot;blue&quot;</span>) </span></code></pre></div>
<p><img src="book_files/figure-html/CO2gof-2.png" width="768" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="model-fitting-and-optimisation.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(co2_fit3)</span>
<span id="cb196-2"><a href="model-fitting-and-optimisation.html#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 14 × 5</span></span>
<span id="cb196-3"><a href="model-fitting-and-optimisation.html#cb196-3" aria-hidden="true" tabindex="-1"></a>   term        estimate std.error statistic  p.value</span>
<span id="cb196-4"><a href="model-fitting-and-optimisation.html#cb196-4" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>          <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb196-5"><a href="model-fitting-and-optimisation.html#cb196-5" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span> (Intercept)  <span class="fl">3.13e+2</span>  <span class="fl">8.43</span>e<span class="sc">-</span> <span class="dv">2</span> <span class="fl">3720.</span>     <span class="dv">0</span>       </span>
<span id="cb196-6"><a href="model-fitting-and-optimisation.html#cb196-6" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span> day0         <span class="fl">1.89e-3</span>  <span class="fl">1.43</span>e<span class="sc">-</span> <span class="dv">5</span>  <span class="fl">132.</span>     <span class="dv">0</span>       </span>
<span id="cb196-7"><a href="model-fitting-and-optimisation.html#cb196-7" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span> <span class="fu">I</span>(day0<span class="sc">^</span><span class="dv">2</span>)    <span class="fl">9.84e-8</span>  <span class="fl">5.40e-10</span>  <span class="fl">182.</span>     <span class="dv">0</span>       </span>
<span id="cb196-8"><a href="model-fitting-and-optimisation.html#cb196-8" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span> month.L      <span class="fl">1.09e+0</span>  <span class="fl">6.71</span>e<span class="sc">-</span> <span class="dv">2</span>   <span class="fl">16.2</span>    <span class="fl">1.07e-53</span></span>
<span id="cb196-9"><a href="model-fitting-and-optimisation.html#cb196-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span> month.Q      <span class="fl">2.20e-1</span>  <span class="fl">6.74</span>e<span class="sc">-</span> <span class="dv">2</span>    <span class="fl">3.26</span>   <span class="fl">1.15</span>e<span class="sc">-</span> <span class="dv">3</span></span>
<span id="cb196-10"><a href="model-fitting-and-optimisation.html#cb196-10" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span> month.C     <span class="sc">-</span><span class="fl">8.42e-1</span>  <span class="fl">6.71</span>e<span class="sc">-</span> <span class="dv">2</span>  <span class="sc">-</span><span class="fl">12.5</span>    <span class="fl">4.13e-34</span></span>
<span id="cb196-11"><a href="model-fitting-and-optimisation.html#cb196-11" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span> month<span class="sc">^</span><span class="dv">4</span>     <span class="sc">-</span><span class="fl">6.13e-2</span>  <span class="fl">6.75</span>e<span class="sc">-</span> <span class="dv">2</span>   <span class="sc">-</span><span class="fl">0.909</span>  <span class="fl">3.63</span>e<span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb196-12"><a href="model-fitting-and-optimisation.html#cb196-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span> month<span class="sc">^</span><span class="dv">5</span>      <span class="fl">1.02e-1</span>  <span class="fl">6.71</span>e<span class="sc">-</span> <span class="dv">2</span>    <span class="fl">1.52</span>   <span class="fl">1.28</span>e<span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb196-13"><a href="model-fitting-and-optimisation.html#cb196-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span> month<span class="sc">^</span><span class="dv">6</span>      <span class="fl">1.09e-1</span>  <span class="fl">6.70</span>e<span class="sc">-</span> <span class="dv">2</span>    <span class="fl">1.63</span>   <span class="fl">1.03</span>e<span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb196-14"><a href="model-fitting-and-optimisation.html#cb196-14" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> month<span class="sc">^</span><span class="dv">7</span>     <span class="sc">-</span><span class="fl">2.22e-2</span>  <span class="fl">6.75</span>e<span class="sc">-</span> <span class="dv">2</span>   <span class="sc">-</span><span class="fl">0.330</span>  <span class="fl">7.42</span>e<span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb196-15"><a href="model-fitting-and-optimisation.html#cb196-15" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span> month<span class="sc">^</span><span class="dv">8</span>     <span class="sc">-</span><span class="fl">8.06e-2</span>  <span class="fl">6.75</span>e<span class="sc">-</span> <span class="dv">2</span>   <span class="sc">-</span><span class="fl">1.19</span>   <span class="fl">2.33</span>e<span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb196-16"><a href="model-fitting-and-optimisation.html#cb196-16" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span> month<span class="sc">^</span><span class="dv">9</span>     <span class="sc">-</span><span class="fl">3.75e-2</span>  <span class="fl">6.72</span>e<span class="sc">-</span> <span class="dv">2</span>   <span class="sc">-</span><span class="fl">0.558</span>  <span class="fl">5.77</span>e<span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb196-17"><a href="model-fitting-and-optimisation.html#cb196-17" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span> month<span class="sc">^</span><span class="dv">10</span>     <span class="fl">3.30e-2</span>  <span class="fl">6.72</span>e<span class="sc">-</span> <span class="dv">2</span>    <span class="fl">0.491</span>  <span class="fl">6.24</span>e<span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb196-18"><a href="model-fitting-and-optimisation.html#cb196-18" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span> month<span class="sc">^</span><span class="dv">11</span>     <span class="fl">2.14e-3</span>  <span class="fl">6.78</span>e<span class="sc">-</span> <span class="dv">2</span>    <span class="fl">0.0315</span> <span class="fl">9.75</span>e<span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb196-19"><a href="model-fitting-and-optimisation.html#cb196-19" aria-hidden="true" tabindex="-1"></a>co2_fit4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(co2<span class="sc">~</span>day0<span class="sc">*</span>month<span class="sc">+</span><span class="fu">I</span>(day0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>month, <span class="at">data=</span>CO2.spo)</span>
<span id="cb196-20"><a href="model-fitting-and-optimisation.html#cb196-20" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(co2_fit4)</span>
<span id="cb196-21"><a href="model-fitting-and-optimisation.html#cb196-21" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 1 × 12</span></span>
<span id="cb196-22"><a href="model-fitting-and-optimisation.html#cb196-22" aria-hidden="true" tabindex="-1"></a>  r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC</span>
<span id="cb196-23"><a href="model-fitting-and-optimisation.html#cb196-23" aria-hidden="true" tabindex="-1"></a>      <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>         <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb196-24"><a href="model-fitting-and-optimisation.html#cb196-24" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="fl">0.999</span>         <span class="fl">0.999</span> <span class="fl">0.693</span>    <span class="fl">55524.</span>       <span class="dv">0</span>    <span class="dv">35</span> <span class="sc">-</span><span class="fl">1319.</span> <span class="fl">2712.</span> <span class="fl">2903.</span></span>
<span id="cb196-25"><a href="model-fitting-and-optimisation.html#cb196-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</span></span>
<span id="cb196-26"><a href="model-fitting-and-optimisation.html#cb196-26" aria-hidden="true" tabindex="-1"></a>co2_model4 <span class="ot">&lt;-</span> <span class="fu">augment</span>(co2_fit4, CO2.spo)</span>
<span id="cb196-27"><a href="model-fitting-and-optimisation.html#cb196-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(co2_model4, <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>co2)) <span class="sc">+</span> </span>
<span id="cb196-28"><a href="model-fitting-and-optimisation.html#cb196-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb196-29"><a href="model-fitting-and-optimisation.html#cb196-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>.fitted), <span class="at">colour=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/CO2gof-3.png" width="768" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="model-fitting-and-optimisation.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">filter</span>(co2_model4, <span class="fu">year</span>(date)<span class="sc">&gt;</span><span class="dv">1965</span>, <span class="fu">year</span>(date)<span class="sc">&lt;</span><span class="dv">1972</span>),</span>
<span id="cb197-2"><a href="model-fitting-and-optimisation.html#cb197-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>co2)) <span class="sc">+</span> </span>
<span id="cb197-3"><a href="model-fitting-and-optimisation.html#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb197-4"><a href="model-fitting-and-optimisation.html#cb197-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>.fitted), <span class="at">colour=</span><span class="st">&quot;blue&quot;</span>) </span></code></pre></div>
<p><img src="book_files/figure-html/CO2gof-4.png" width="768" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="beyond-a-single-model" class="section level2 hasAnchor" number="16.11">
<h2><span class="header-section-number">16.11</span> Beyond a single model<a href="model-fitting-and-optimisation.html#beyond-a-single-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><img src="images/blind-men-and-the-elephant.png" /></p>
<p><br></p>
<p>Image source: <a href="https://balajiviswanathan.quora.com/Lessons-from-the-Blind-men-and-the-elephant" class="uri">https://balajiviswanathan.quora.com/Lessons-from-the-Blind-men-and-the-elephant</a></p>
</div>
<div id="gapminder" class="section level2 hasAnchor" number="16.12">
<h2><span class="header-section-number">16.12</span> Gapminder<a href="model-fitting-and-optimisation.html#gapminder" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Hans Rosling was a Swedish doctor, academic and statistician, Professor of International Health at Karolinska Institute. He passed away in 2017. He developed a keen interest in health and wealth across the globe, and the relationship with other factors like agriculture, education, energy. His presentations on data are amazing! A starting place is <a href="https://www.youtube.com/watch?v=jbkSRLYSojo" class="uri">https://www.youtube.com/watch?v=jbkSRLYSojo</a>.</p>
<p>And you can play with the gapminder data using animations at <a href="https://www.gapminder.org/tools/" class="uri">https://www.gapminder.org/tools/</a>.</p>
<div id="r-package" class="section level3 hasAnchor" number="16.12.1">
<h3><span class="header-section-number">16.12.1</span> R package<a href="model-fitting-and-optimisation.html#r-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The R package, called gapminder, contains a subset of the data. It has data on five year intervals from 1952 to 2007.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="model-fitting-and-optimisation.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb198-2"><a href="model-fitting-and-optimisation.html#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(gapminder)</span>
<span id="cb198-3"><a href="model-fitting-and-optimisation.html#cb198-3" aria-hidden="true" tabindex="-1"></a>Rows<span class="sc">:</span> <span class="dv">1</span>,<span class="dv">704</span></span>
<span id="cb198-4"><a href="model-fitting-and-optimisation.html#cb198-4" aria-hidden="true" tabindex="-1"></a>Columns<span class="sc">:</span> <span class="dv">6</span></span>
<span id="cb198-5"><a href="model-fitting-and-optimisation.html#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span> country   <span class="sc">&lt;</span>fct<span class="sc">&gt;</span> <span class="st">&quot;Afghanistan&quot;</span>, <span class="st">&quot;Afghanistan&quot;</span>, <span class="st">&quot;Afghanistan&quot;</span>, <span class="st">&quot;Afghanistan&quot;</span>, …</span>
<span id="cb198-6"><a href="model-fitting-and-optimisation.html#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span> continent <span class="sc">&lt;</span>fct<span class="sc">&gt;</span> Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, …</span>
<span id="cb198-7"><a href="model-fitting-and-optimisation.html#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span> year      <span class="sc">&lt;</span>int<span class="sc">&gt;</span> <span class="dv">1952</span>, <span class="dv">1957</span>, <span class="dv">1962</span>, <span class="dv">1967</span>, <span class="dv">1972</span>, <span class="dv">1977</span>, <span class="dv">1982</span>, <span class="dv">1987</span>, <span class="dv">1992</span>, <span class="dv">1997</span>, …</span>
<span id="cb198-8"><a href="model-fitting-and-optimisation.html#cb198-8" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span> lifeExp   <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="fl">28.801</span>, <span class="fl">30.332</span>, <span class="fl">31.997</span>, <span class="fl">34.020</span>, <span class="fl">36.088</span>, <span class="fl">38.438</span>, <span class="fl">39.854</span>, <span class="fl">40.8</span>…</span>
<span id="cb198-9"><a href="model-fitting-and-optimisation.html#cb198-9" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span> pop       <span class="sc">&lt;</span>int<span class="sc">&gt;</span> <span class="dv">8425333</span>, <span class="dv">9240934</span>, <span class="dv">10267083</span>, <span class="dv">11537966</span>, <span class="dv">13079460</span>, <span class="dv">14880372</span>, 12…</span>
<span id="cb198-10"><a href="model-fitting-and-optimisation.html#cb198-10" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span> gdpPercap <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="fl">779.4453</span>, <span class="fl">820.8530</span>, <span class="fl">853.1007</span>, <span class="fl">836.1971</span>, <span class="fl">739.9811</span>, <span class="fl">786.1134</span>, …</span></code></pre></div>
</div>
</div>
<div id="fit-linear-models" class="section level2 hasAnchor" number="16.13">
<h2><span class="header-section-number">16.13</span> Fit linear models<a href="model-fitting-and-optimisation.html#fit-linear-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The question is “How has life expectancy changed over years, for each country?”</p>
<p>Plot life expectancy by year, for each country.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="model-fitting-and-optimisation.html#cb199-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb199-2"><a href="model-fitting-and-optimisation.html#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, lifeExp, <span class="at">group =</span> country)) <span class="sc">+</span></span>
<span id="cb199-3"><a href="model-fitting-and-optimisation.html#cb199-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/gapplot-1.png" width="768" style="display: block; margin: auto;" /></p>
<ul>
<li>There generally appears to be an increase in life expectancy</li>
<li>A number of countries have big dips from the 70s through 90s</li>
<li>a cluster of countries starts off with low life expectancy but ends up close to the highest by the end of the period.</li>
</ul>
<div id="mutate-year" class="section level3 hasAnchor" number="16.13.1">
<h3><span class="header-section-number">16.13.1</span> Mutate year<a href="model-fitting-and-optimisation.html#mutate-year" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>1950 is the first year, so for model fitting we are going to shift year to begin in 1950, makes interpretability easier.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="model-fitting-and-optimisation.html#cb200-1" aria-hidden="true" tabindex="-1"></a>gapminder2 <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year1950 =</span> year<span class="dv">-1950</span>)</span></code></pre></div>
</div>
</div>
<div id="australia" class="section level2 hasAnchor" number="16.14">
<h2><span class="header-section-number">16.14</span> Australia<a href="model-fitting-and-optimisation.html#australia" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Australia was already had one of the top life expectancies in the 1950s.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="model-fitting-and-optimisation.html#cb201-1" aria-hidden="true" tabindex="-1"></a>oz <span class="ot">&lt;-</span> gapminder2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country<span class="sc">==</span><span class="st">&quot;Australia&quot;</span>)</span>
<span id="cb201-2"><a href="model-fitting-and-optimisation.html#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(oz)</span>
<span id="cb201-3"><a href="model-fitting-and-optimisation.html#cb201-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 × 7</span></span>
<span id="cb201-4"><a href="model-fitting-and-optimisation.html#cb201-4" aria-hidden="true" tabindex="-1"></a>  country   continent  year lifeExp      pop gdpPercap year1950</span>
<span id="cb201-5"><a href="model-fitting-and-optimisation.html#cb201-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>fct<span class="sc">&gt;</span>     <span class="er">&lt;</span>fct<span class="sc">&gt;</span>     <span class="er">&lt;</span>int<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>int<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb201-6"><a href="model-fitting-and-optimisation.html#cb201-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Australia Oceania    <span class="dv">1952</span>    <span class="fl">69.1</span>  <span class="dv">8691212</span>    <span class="fl">10040.</span>        <span class="dv">2</span></span>
<span id="cb201-7"><a href="model-fitting-and-optimisation.html#cb201-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Australia Oceania    <span class="dv">1957</span>    <span class="fl">70.3</span>  <span class="dv">9712569</span>    <span class="fl">10950.</span>        <span class="dv">7</span></span>
<span id="cb201-8"><a href="model-fitting-and-optimisation.html#cb201-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> Australia Oceania    <span class="dv">1962</span>    <span class="fl">70.9</span> <span class="dv">10794968</span>    <span class="fl">12217.</span>       <span class="dv">12</span></span>
<span id="cb201-9"><a href="model-fitting-and-optimisation.html#cb201-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> Australia Oceania    <span class="dv">1967</span>    <span class="fl">71.1</span> <span class="dv">11872264</span>    <span class="fl">14526.</span>       <span class="dv">17</span></span>
<span id="cb201-10"><a href="model-fitting-and-optimisation.html#cb201-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> Australia Oceania    <span class="dv">1972</span>    <span class="fl">71.9</span> <span class="dv">13177000</span>    <span class="fl">16789.</span>       <span class="dv">22</span></span>
<span id="cb201-11"><a href="model-fitting-and-optimisation.html#cb201-11" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> Australia Oceania    <span class="dv">1977</span>    <span class="fl">73.5</span> <span class="dv">14074100</span>    <span class="fl">18334.</span>       <span class="dv">27</span></span>
<span id="cb201-12"><a href="model-fitting-and-optimisation.html#cb201-12" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>oz, <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>lifeExp)) <span class="sc">+</span> </span>
<span id="cb201-13"><a href="model-fitting-and-optimisation.html#cb201-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() </span>
<span id="cb201-14"><a href="model-fitting-and-optimisation.html#cb201-14" aria-hidden="true" tabindex="-1"></a>oz_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(lifeExp<span class="sc">~</span>year1950, <span class="at">data=</span>oz)</span>
<span id="cb201-15"><a href="model-fitting-and-optimisation.html#cb201-15" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(oz_lm)</span>
<span id="cb201-16"><a href="model-fitting-and-optimisation.html#cb201-16" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 2 × 5</span></span>
<span id="cb201-17"><a href="model-fitting-and-optimisation.html#cb201-17" aria-hidden="true" tabindex="-1"></a>  term        estimate std.error statistic  p.value</span>
<span id="cb201-18"><a href="model-fitting-and-optimisation.html#cb201-18" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>          <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb201-19"><a href="model-fitting-and-optimisation.html#cb201-19" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> (Intercept)   <span class="fl">67.9</span>      <span class="fl">0.355</span>      <span class="fl">192.</span>  <span class="fl">3.70e-19</span></span>
<span id="cb201-20"><a href="model-fitting-and-optimisation.html#cb201-20" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> year1950       <span class="fl">0.228</span>    <span class="fl">0.0104</span>      <span class="fl">21.9</span> <span class="fl">8.67e-10</span></span>
<span id="cb201-21"><a href="model-fitting-and-optimisation.html#cb201-21" aria-hidden="true" tabindex="-1"></a>oz_mod <span class="ot">&lt;-</span> <span class="fu">augment</span>(oz_lm, oz)</span>
<span id="cb201-22"><a href="model-fitting-and-optimisation.html#cb201-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>oz_mod, <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>.fitted)) <span class="sc">+</span> </span>
<span id="cb201-23"><a href="model-fitting-and-optimisation.html#cb201-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() </span>
<span id="cb201-24"><a href="model-fitting-and-optimisation.html#cb201-24" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>oz_mod, <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>.std.resid)) <span class="sc">+</span> </span>
<span id="cb201-25"><a href="model-fitting-and-optimisation.html#cb201-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>, <span class="at">colour=</span><span class="st">&quot;white&quot;</span>, <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb201-26"><a href="model-fitting-and-optimisation.html#cb201-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() </span>
<span id="cb201-27"><a href="model-fitting-and-optimisation.html#cb201-27" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/gapmod-1.png" width="768" style="display: block; margin: auto;" /></p>
<ul>
<li>Life expectancy has increased 2.3 years every decade, on average.</li>
<li>There was a slow period from 1960 through to 1972, probably related to mortality during the Vietnam war.</li>
</ul>
</div>
<div id="fit-all-countries" class="section level2 hasAnchor" number="16.15">
<h2><span class="header-section-number">16.15</span> Fit all countries<a href="model-fitting-and-optimisation.html#fit-all-countries" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="model-fitting-and-optimisation.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb202-2"><a href="model-fitting-and-optimisation.html#cb202-2" aria-hidden="true" tabindex="-1"></a>by_country <span class="ot">&lt;-</span> gapminder2 <span class="sc">%&gt;%</span> </span>
<span id="cb202-3"><a href="model-fitting-and-optimisation.html#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year1950, lifeExp, continent) <span class="sc">%&gt;%</span></span>
<span id="cb202-4"><a href="model-fitting-and-optimisation.html#cb202-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, continent) <span class="sc">%&gt;%</span> </span>
<span id="cb202-5"><a href="model-fitting-and-optimisation.html#cb202-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb202-6"><a href="model-fitting-and-optimisation.html#cb202-6" aria-hidden="true" tabindex="-1"></a>by_country <span class="ot">&lt;-</span> by_country <span class="sc">%&gt;%</span> </span>
<span id="cb202-7"><a href="model-fitting-and-optimisation.html#cb202-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb202-8"><a href="model-fitting-and-optimisation.html#cb202-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> purrr<span class="sc">::</span><span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">lm</span>(lifeExp <span class="sc">~</span> year1950, </span>
<span id="cb202-9"><a href="model-fitting-and-optimisation.html#cb202-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">data =</span> .))</span>
<span id="cb202-10"><a href="model-fitting-and-optimisation.html#cb202-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb202-11"><a href="model-fitting-and-optimisation.html#cb202-11" aria-hidden="true" tabindex="-1"></a>country_coefs <span class="ot">&lt;-</span> by_country <span class="sc">%&gt;%</span> </span>
<span id="cb202-12"><a href="model-fitting-and-optimisation.html#cb202-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> purrr<span class="sc">::</span><span class="fu">map</span>(model, broom<span class="sc">::</span>tidy)) <span class="sc">%&gt;%</span></span>
<span id="cb202-13"><a href="model-fitting-and-optimisation.html#cb202-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(model)</span>
<span id="cb202-14"><a href="model-fitting-and-optimisation.html#cb202-14" aria-hidden="true" tabindex="-1"></a>country_coefs <span class="ot">&lt;-</span> country_coefs <span class="sc">%&gt;%</span> </span>
<span id="cb202-15"><a href="model-fitting-and-optimisation.html#cb202-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, continent, term, estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb202-16"><a href="model-fitting-and-optimisation.html#cb202-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(term, estimate) <span class="sc">%&gt;%</span></span>
<span id="cb202-17"><a href="model-fitting-and-optimisation.html#cb202-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">intercept =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>)</span>
<span id="cb202-18"><a href="model-fitting-and-optimisation.html#cb202-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(country_coefs)</span>
<span id="cb202-19"><a href="model-fitting-and-optimisation.html#cb202-19" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 × 4</span></span>
<span id="cb202-20"><a href="model-fitting-and-optimisation.html#cb202-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Groups:   country, continent [6]</span></span>
<span id="cb202-21"><a href="model-fitting-and-optimisation.html#cb202-21" aria-hidden="true" tabindex="-1"></a>  country     continent intercept year1950</span>
<span id="cb202-22"><a href="model-fitting-and-optimisation.html#cb202-22" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>fct<span class="sc">&gt;</span>       <span class="er">&lt;</span>fct<span class="sc">&gt;</span>         <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb202-23"><a href="model-fitting-and-optimisation.html#cb202-23" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Afghanistan Asia           <span class="fl">29.4</span>    <span class="fl">0.275</span></span>
<span id="cb202-24"><a href="model-fitting-and-optimisation.html#cb202-24" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Albania     Europe         <span class="fl">58.6</span>    <span class="fl">0.335</span></span>
<span id="cb202-25"><a href="model-fitting-and-optimisation.html#cb202-25" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> Algeria     Africa         <span class="fl">42.2</span>    <span class="fl">0.569</span></span>
<span id="cb202-26"><a href="model-fitting-and-optimisation.html#cb202-26" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> Angola      Africa         <span class="fl">31.7</span>    <span class="fl">0.209</span></span>
<span id="cb202-27"><a href="model-fitting-and-optimisation.html#cb202-27" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> Argentina   Americas       <span class="fl">62.2</span>    <span class="fl">0.232</span></span>
<span id="cb202-28"><a href="model-fitting-and-optimisation.html#cb202-28" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> Australia   Oceania        <span class="fl">67.9</span>    <span class="fl">0.228</span></span>
<span id="cb202-29"><a href="model-fitting-and-optimisation.html#cb202-29" aria-hidden="true" tabindex="-1"></a>country_coefs <span class="sc">%&gt;%</span></span>
<span id="cb202-30"><a href="model-fitting-and-optimisation.html#cb202-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">&quot;Australia&quot;</span>)</span>
<span id="cb202-31"><a href="model-fitting-and-optimisation.html#cb202-31" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 1 × 4</span></span>
<span id="cb202-32"><a href="model-fitting-and-optimisation.html#cb202-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Groups:   country, continent [1]</span></span>
<span id="cb202-33"><a href="model-fitting-and-optimisation.html#cb202-33" aria-hidden="true" tabindex="-1"></a>  country   continent intercept year1950</span>
<span id="cb202-34"><a href="model-fitting-and-optimisation.html#cb202-34" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>fct<span class="sc">&gt;</span>     <span class="er">&lt;</span>fct<span class="sc">&gt;</span>         <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb202-35"><a href="model-fitting-and-optimisation.html#cb202-35" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Australia Oceania        <span class="fl">67.9</span>    <span class="fl">0.228</span></span></code></pre></div>
<p>It is also possible to use a <code>for</code> loop to compute the slope and intercept for each country.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="model-fitting-and-optimisation.html#cb203-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">table</span>(gapminder2<span class="sc">$</span>country))</span>
<span id="cb203-2"><a href="model-fitting-and-optimisation.html#cb203-2" aria-hidden="true" tabindex="-1"></a>country_coefs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">country=</span>gapminder2<span class="sc">$</span>country[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1704</span>, <span class="dv">12</span>)],</span>
<span id="cb203-3"><a href="model-fitting-and-optimisation.html#cb203-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">continent=</span>gapminder2<span class="sc">$</span>continent[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1704</span>, <span class="dv">12</span>)],</span>
<span id="cb203-4"><a href="model-fitting-and-optimisation.html#cb203-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">intercept=</span><span class="fu">rep</span>(<span class="dv">0</span>,n), </span>
<span id="cb203-5"><a href="model-fitting-and-optimisation.html#cb203-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">year1950=</span><span class="fu">rep</span>(<span class="dv">0</span>,n))</span>
<span id="cb203-6"><a href="model-fitting-and-optimisation.html#cb203-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb203-7"><a href="model-fitting-and-optimisation.html#cb203-7" aria-hidden="true" tabindex="-1"></a>  sub <span class="ot">&lt;-</span> gapminder2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country<span class="sc">==</span>country_coefs<span class="sc">$</span>country[i])</span>
<span id="cb203-8"><a href="model-fitting-and-optimisation.html#cb203-8" aria-hidden="true" tabindex="-1"></a>  sub_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(lifeExp<span class="sc">~</span>year1950, <span class="at">data=</span>sub)</span>
<span id="cb203-9"><a href="model-fitting-and-optimisation.html#cb203-9" aria-hidden="true" tabindex="-1"></a>  sub_lm_coefs <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(sub_lm)</span>
<span id="cb203-10"><a href="model-fitting-and-optimisation.html#cb203-10" aria-hidden="true" tabindex="-1"></a>  country_coefs<span class="sc">$</span>intercept[i] <span class="ot">&lt;-</span> sub_lm_coefs[<span class="dv">1</span>]</span>
<span id="cb203-11"><a href="model-fitting-and-optimisation.html#cb203-11" aria-hidden="true" tabindex="-1"></a>  country_coefs<span class="sc">$</span>year1950[i] <span class="ot">&lt;-</span> sub_lm_coefs[<span class="dv">2</span>]</span>
<span id="cb203-12"><a href="model-fitting-and-optimisation.html#cb203-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb203-13"><a href="model-fitting-and-optimisation.html#cb203-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(country_coefs)</span></code></pre></div>
<div id="five-minute-challenge" class="section level3 hasAnchor" number="16.15.1">
<h3><span class="header-section-number">16.15.1</span> Five minute challenge<a href="model-fitting-and-optimisation.html#five-minute-challenge" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Fit the models to all countries</li>
<li>Pick your favourite country (not Australia), print the coefficients, and make a hand sketch of the the model fit.</li>
</ul>
</div>
<div id="plot-all-the-models" class="section level3 hasAnchor" number="16.15.2">
<h3><span class="header-section-number">16.15.2</span> Plot all the models<a href="model-fitting-and-optimisation.html#plot-all-the-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="model-fitting-and-optimisation.html#cb204-1" aria-hidden="true" tabindex="-1"></a>country_model <span class="ot">&lt;-</span> by_country <span class="sc">%&gt;%</span> </span>
<span id="cb204-2"><a href="model-fitting-and-optimisation.html#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> purrr<span class="sc">::</span><span class="fu">map</span>(model, broom<span class="sc">::</span>augment)) <span class="sc">%&gt;%</span></span>
<span id="cb204-3"><a href="model-fitting-and-optimisation.html#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(model)</span>
<span id="cb204-4"><a href="model-fitting-and-optimisation.html#cb204-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb204-5"><a href="model-fitting-and-optimisation.html#cb204-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, lifeExp, <span class="at">group =</span> country)) <span class="sc">+</span></span>
<span id="cb204-6"><a href="model-fitting-and-optimisation.html#cb204-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Data&quot;</span>)</span>
<span id="cb204-7"><a href="model-fitting-and-optimisation.html#cb204-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(country_model) <span class="sc">+</span> </span>
<span id="cb204-8"><a href="model-fitting-and-optimisation.html#cb204-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>year1950<span class="sc">+</span><span class="dv">1950</span>, <span class="at">y=</span>.fitted, <span class="at">group=</span>country), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb204-9"><a href="model-fitting-and-optimisation.html#cb204-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;year&quot;</span>) <span class="sc">+</span></span>
<span id="cb204-10"><a href="model-fitting-and-optimisation.html#cb204-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Fitted models&quot;</span>)</span>
<span id="cb204-11"><a href="model-fitting-and-optimisation.html#cb204-11" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/gapplotall-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="plot-all-the-model-coefficients" class="section level3 hasAnchor" number="16.15.3">
<h3><span class="header-section-number">16.15.3</span> Plot all the model coefficients<a href="model-fitting-and-optimisation.html#plot-all-the-model-coefficients" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="model-fitting-and-optimisation.html#cb205-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(country_coefs, <span class="fu">aes</span>(<span class="at">x=</span>intercept, <span class="at">y=</span>year1950, </span>
<span id="cb205-2"><a href="model-fitting-and-optimisation.html#cb205-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colour=</span>continent, <span class="at">label=</span>country)) <span class="sc">+</span></span>
<span id="cb205-3"><a href="model-fitting-and-optimisation.html#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb205-4"><a href="model-fitting-and-optimisation.html#cb205-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>)</span>
<span id="cb205-5"><a href="model-fitting-and-optimisation.html#cb205-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb205-6"><a href="model-fitting-and-optimisation.html#cb205-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(p)</span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3a0e2fb557e545ba2597" style="width:768px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-3a0e2fb557e545ba2597">{"x":{"data":[{"x":[42.2364149184149,31.7079741258741,38.9200470862471,52.8077783216784,33.9567426573427,40.2703724941725,40.7491678321678,38.4417016317017,39.3028836829837,39.0952181818182,41.7732461538462,46.7465904428905,44.5847456876457,35.5423468531469,39.8570909090909,33.8099664335665,34.9458888111888,35.4137832167833,38.0418804195804,27.2367200466201,42.8492582750583,30.7073256410257,31.1935321678322,46.5890230769231,47.1878941724942,39.6444356643357,40.8508645687646,35.8606081585082,36.4419200466201,32.2976111888112,39.1327675990676,54.6738615384616,41.6058878787879,33.7571832167832,46.6720060606061,34.4664484848485,37.4433941724942,53.0777776223777,42.8336116550117,47.8461990675991,35.7372666666667,30.4551351981352,34.2162505827506,49.0029631701632,37.1086426573426,46.1977093240093,42.759034032634,40.2122769230769,43.379620979021,44.0320459207459,47.778875990676,55.4072855477856],"y":[0.56927972027972,0.20933986013986,0.334232867132867,0.0606685314685308,0.363974825174825,0.154134265734266,0.250146853146853,0.183905594405594,0.253244055944055,0.450390909090908,0.0939153846153844,0.195095804195804,0.130556643356643,0.367403496503496,0.555454545454545,0.310170629370629,0.37469020979021,0.307185314685314,0.446732867132867,0.581825874125873,0.321742657342657,0.424830769230769,0.271753146853147,0.206507692307692,0.0955657342657342,0.0959937062937061,0.625535664335664,0.403727972027972,0.234225874125874,0.37680979020979,0.446417482517482,0.348453846153845,0.542472727272727,0.224485314685315,0.231163636363636,0.342109090909091,0.208065734265734,0.459880419580419,-0.0458314685314688,0.340682517482517,0.5047,0.214034965034965,0.229573426573426,0.16915944055944,0.382774825174825,0.0950748251748251,0.174688111888112,0.382592307692307,0.587843356643356,0.121586013986014,-0.0604251748251748,-0.0930209790209793],"text":["intercept: 42.23641<br />year1950:  0.56927972<br />continent: Africa<br />country: Algeria","intercept: 31.70797<br />year1950:  0.20933986<br />continent: Africa<br />country: Angola","intercept: 38.92005<br />year1950:  0.33423287<br />continent: Africa<br />country: Benin","intercept: 52.80778<br />year1950:  0.06066853<br />continent: Africa<br />country: Botswana","intercept: 33.95674<br />year1950:  0.36397483<br />continent: Africa<br />country: Burkina Faso","intercept: 40.27037<br />year1950:  0.15413427<br />continent: Africa<br />country: Burundi","intercept: 40.74917<br />year1950:  0.25014685<br />continent: Africa<br />country: Cameroon","intercept: 38.44170<br />year1950:  0.18390559<br />continent: Africa<br />country: Central African Republic","intercept: 39.30288<br />year1950:  0.25324406<br />continent: Africa<br />country: Chad","intercept: 39.09522<br />year1950:  0.45039091<br />continent: Africa<br />country: Comoros","intercept: 41.77325<br />year1950:  0.09391538<br />continent: Africa<br />country: Congo, Dem. Rep.","intercept: 46.74659<br />year1950:  0.19509580<br />continent: Africa<br />country: Congo, Rep.","intercept: 44.58475<br />year1950:  0.13055664<br />continent: Africa<br />country: Cote d'Ivoire","intercept: 35.54235<br />year1950:  0.36740350<br />continent: Africa<br />country: Djibouti","intercept: 39.85709<br />year1950:  0.55545455<br />continent: Africa<br />country: Egypt","intercept: 33.80997<br />year1950:  0.31017063<br />continent: Africa<br />country: Equatorial Guinea","intercept: 34.94589<br />year1950:  0.37469021<br />continent: Africa<br />country: Eritrea","intercept: 35.41378<br />year1950:  0.30718531<br />continent: Africa<br />country: Ethiopia","intercept: 38.04188<br />year1950:  0.44673287<br />continent: Africa<br />country: Gabon","intercept: 27.23672<br />year1950:  0.58182587<br />continent: Africa<br />country: Gambia","intercept: 42.84926<br />year1950:  0.32174266<br />continent: Africa<br />country: Ghana","intercept: 30.70733<br />year1950:  0.42483077<br />continent: Africa<br />country: Guinea","intercept: 31.19353<br />year1950:  0.27175315<br />continent: Africa<br />country: Guinea-Bissau","intercept: 46.58902<br />year1950:  0.20650769<br />continent: Africa<br />country: Kenya","intercept: 47.18789<br />year1950:  0.09556573<br />continent: Africa<br />country: Lesotho","intercept: 39.64444<br />year1950:  0.09599371<br />continent: Africa<br />country: Liberia","intercept: 40.85086<br />year1950:  0.62553566<br />continent: Africa<br />country: Libya","intercept: 35.86061<br />year1950:  0.40372797<br />continent: Africa<br />country: Madagascar","intercept: 36.44192<br />year1950:  0.23422587<br />continent: Africa<br />country: Malawi","intercept: 32.29761<br />year1950:  0.37680979<br />continent: Africa<br />country: Mali","intercept: 39.13277<br />year1950:  0.44641748<br />continent: Africa<br />country: Mauritania","intercept: 54.67386<br />year1950:  0.34845385<br />continent: Africa<br />country: Mauritius","intercept: 41.60589<br />year1950:  0.54247273<br />continent: Africa<br />country: Morocco","intercept: 33.75718<br />year1950:  0.22448531<br />continent: Africa<br />country: Mozambique","intercept: 46.67201<br />year1950:  0.23116364<br />continent: Africa<br />country: Namibia","intercept: 34.46645<br />year1950:  0.34210909<br />continent: Africa<br />country: Niger","intercept: 37.44339<br />year1950:  0.20806573<br />continent: Africa<br />country: Nigeria","intercept: 53.07778<br />year1950:  0.45988042<br />continent: Africa<br />country: Reunion","intercept: 42.83361<br />year1950: -0.04583147<br />continent: Africa<br />country: Rwanda","intercept: 47.84620<br />year1950:  0.34068252<br />continent: Africa<br />country: Sao Tome and Principe","intercept: 35.73727<br />year1950:  0.50470000<br />continent: Africa<br />country: Senegal","intercept: 30.45514<br />year1950:  0.21403497<br />continent: Africa<br />country: Sierra Leone","intercept: 34.21625<br />year1950:  0.22957343<br />continent: Africa<br />country: Somalia","intercept: 49.00296<br />year1950:  0.16915944<br />continent: Africa<br />country: South Africa","intercept: 37.10864<br />year1950:  0.38277483<br />continent: Africa<br />country: Sudan","intercept: 46.19771<br />year1950:  0.09507483<br />continent: Africa<br />country: Swaziland","intercept: 42.75903<br />year1950:  0.17468811<br />continent: Africa<br />country: Tanzania","intercept: 40.21228<br />year1950:  0.38259231<br />continent: Africa<br />country: Togo","intercept: 43.37962<br />year1950:  0.58784336<br />continent: Africa<br />country: Tunisia","intercept: 44.03205<br />year1950:  0.12158601<br />continent: Africa<br />country: Uganda","intercept: 47.77888<br />year1950: -0.06042517<br />continent: Africa<br />country: Zambia","intercept: 55.40729<br />year1950: -0.09302098<br />continent: Africa<br />country: Zimbabwe"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(27,158,119,1)","opacity":0.5,"size":7.55905511811024,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(27,158,119,1)"}},"hoveron":"points","name":"Africa","legendgroup":"Africa","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[62.2250191142191,37.7565843822844,50.7318594405595,68.4461076923077,53.364017016317,52.6656146853147,58.2991261072261,61.571148018648,47.6555027972028,48.0652655011655,45.5576662004662,41.0568505827506,38.4520377622378,41.9067067599068,62.2181983682984,52.1033018648019,41.9320890442891,57.3525818181819,62.1671242424243,43.2922452214453,66.527375990676,61.7049846153846,68.0455076923077,65.3750585081585,56.8538771561772],"y":[0.231708391608391,0.499932167832168,0.39008951048951,0.21886923076923,0.476844055944055,0.380750349650349,0.40278951048951,0.321150349650349,0.471152447552447,0.500053146853146,0.477141258741258,0.531273426573426,0.397058041958041,0.542851748251748,0.221394405594405,0.451034965034965,0.55651958041958,0.35420909090909,0.157354545454545,0.527697902097902,0.210574825174824,0.173661538461538,0.184169230769231,0.183272027972027,0.329721678321678],"text":["intercept: 62.22502<br />year1950:  0.23170839<br />continent: Americas<br />country: Argentina","intercept: 37.75658<br />year1950:  0.49993217<br />continent: Americas<br />country: Bolivia","intercept: 50.73186<br />year1950:  0.39008951<br />continent: Americas<br />country: Brazil","intercept: 68.44611<br />year1950:  0.21886923<br />continent: Americas<br />country: Canada","intercept: 53.36402<br />year1950:  0.47684406<br />continent: Americas<br />country: Chile","intercept: 52.66561<br />year1950:  0.38075035<br />continent: Americas<br />country: Colombia","intercept: 58.29913<br />year1950:  0.40278951<br />continent: Americas<br />country: Costa Rica","intercept: 61.57115<br />year1950:  0.32115035<br />continent: Americas<br />country: Cuba","intercept: 47.65550<br />year1950:  0.47115245<br />continent: Americas<br />country: Dominican Republic","intercept: 48.06527<br />year1950:  0.50005315<br />continent: Americas<br />country: Ecuador","intercept: 45.55767<br />year1950:  0.47714126<br />continent: Americas<br />country: El Salvador","intercept: 41.05685<br />year1950:  0.53127343<br />continent: Americas<br />country: Guatemala","intercept: 38.45204<br />year1950:  0.39705804<br />continent: Americas<br />country: Haiti","intercept: 41.90671<br />year1950:  0.54285175<br />continent: Americas<br />country: Honduras","intercept: 62.21820<br />year1950:  0.22139441<br />continent: Americas<br />country: Jamaica","intercept: 52.10330<br />year1950:  0.45103497<br />continent: Americas<br />country: Mexico","intercept: 41.93209<br />year1950:  0.55651958<br />continent: Americas<br />country: Nicaragua","intercept: 57.35258<br />year1950:  0.35420909<br />continent: Americas<br />country: Panama","intercept: 62.16712<br />year1950:  0.15735455<br />continent: Americas<br />country: Paraguay","intercept: 43.29225<br />year1950:  0.52769790<br />continent: Americas<br />country: Peru","intercept: 66.52738<br />year1950:  0.21057483<br />continent: Americas<br />country: Puerto Rico","intercept: 61.70498<br />year1950:  0.17366154<br />continent: Americas<br />country: Trinidad and Tobago","intercept: 68.04551<br />year1950:  0.18416923<br />continent: Americas<br />country: United States","intercept: 65.37506<br />year1950:  0.18327203<br />continent: Americas<br />country: Uruguay","intercept: 56.85388<br />year1950:  0.32972168<br />continent: Americas<br />country: Venezuela"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(217,95,2,1)","opacity":0.5,"size":7.55905511811024,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(217,95,2,1)"}},"hoveron":"points","name":"Americas","legendgroup":"Americas","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[29.3566375291375,51.8141897435898,35.1392256410256,36.2236174825175,46.1290518321678,62.6966997668998,38.2591144522145,35.6138328671329,43.9857074592075,49.6430405594406,65.7661976689977,64.4162428904429,42.9204002331003,54.2727494172495,48.6167,56.6256606060606,58.1653002331003,50.5761731934732,42.9490340326341,40.5453610722611,33.373117948718,35.6633855477856,42.9113769230769,48.5634076923077,39.5148692307692,61.1641125874126,59.3016983682984,44.9925631701632,60.6829463869464,51.9623265734266,37.6668461538462,42.5961960372961,28.9193631701632],"y":[0.275328671328671,0.467507692307692,0.498130769230769,0.395902797202797,0.530714853146853,0.365970629370629,0.505320979020979,0.634641258741258,0.496639860139859,0.235210489510489,0.267106293706293,0.352904195804195,0.57172937062937,0.316426573426573,0.5554,0.416836363636363,0.26102937062937,0.464522377622377,0.438688111888111,0.433095104895104,0.529261538461538,0.772179020979021,0.405792307692307,0.42046923076923,0.649623076923077,0.340886013986013,0.244894405594405,0.55435944055944,0.327244755244755,0.347048251748251,0.671615384615384,0.601100699300699,0.60545944055944],"text":["intercept: 29.35664<br />year1950:  0.27532867<br />continent: Asia<br />country: Afghanistan","intercept: 51.81419<br />year1950:  0.46750769<br />continent: Asia<br />country: Bahrain","intercept: 35.13923<br />year1950:  0.49813077<br />continent: Asia<br />country: Bangladesh","intercept: 36.22362<br />year1950:  0.39590280<br />continent: Asia<br />country: Cambodia","intercept: 46.12905<br />year1950:  0.53071485<br />continent: Asia<br />country: China","intercept: 62.69670<br />year1950:  0.36597063<br />continent: Asia<br />country: Hong Kong, China","intercept: 38.25911<br />year1950:  0.50532098<br />continent: Asia<br />country: India","intercept: 35.61383<br />year1950:  0.63464126<br />continent: Asia<br />country: Indonesia","intercept: 43.98571<br />year1950:  0.49663986<br />continent: Asia<br />country: Iran","intercept: 49.64304<br />year1950:  0.23521049<br />continent: Asia<br />country: Iraq","intercept: 65.76620<br />year1950:  0.26710629<br />continent: Asia<br />country: Israel","intercept: 64.41624<br />year1950:  0.35290420<br />continent: Asia<br />country: Japan","intercept: 42.92040<br />year1950:  0.57172937<br />continent: Asia<br />country: Jordan","intercept: 54.27275<br />year1950:  0.31642657<br />continent: Asia<br />country: Korea, Dem. Rep.","intercept: 48.61670<br />year1950:  0.55540000<br />continent: Asia<br />country: Korea, Rep.","intercept: 56.62566<br />year1950:  0.41683636<br />continent: Asia<br />country: Kuwait","intercept: 58.16530<br />year1950:  0.26102937<br />continent: Asia<br />country: Lebanon","intercept: 50.57617<br />year1950:  0.46452238<br />continent: Asia<br />country: Malaysia","intercept: 42.94903<br />year1950:  0.43868811<br />continent: Asia<br />country: Mongolia","intercept: 40.54536<br />year1950:  0.43309510<br />continent: Asia<br />country: Myanmar","intercept: 33.37312<br />year1950:  0.52926154<br />continent: Asia<br />country: Nepal","intercept: 35.66339<br />year1950:  0.77217902<br />continent: Asia<br />country: Oman","intercept: 42.91138<br />year1950:  0.40579231<br />continent: Asia<br />country: Pakistan","intercept: 48.56341<br />year1950:  0.42046923<br />continent: Asia<br />country: Philippines","intercept: 39.51487<br />year1950:  0.64962308<br />continent: Asia<br />country: Saudi Arabia","intercept: 61.16411<br />year1950:  0.34088601<br />continent: Asia<br />country: Singapore","intercept: 59.30170<br />year1950:  0.24489441<br />continent: Asia<br />country: Sri Lanka","intercept: 44.99256<br />year1950:  0.55435944<br />continent: Asia<br />country: Syria","intercept: 60.68295<br />year1950:  0.32724476<br />continent: Asia<br />country: Taiwan","intercept: 51.96233<br />year1950:  0.34704825<br />continent: Asia<br />country: Thailand","intercept: 37.66685<br />year1950:  0.67161538<br />continent: Asia<br />country: Vietnam","intercept: 42.59620<br />year1950:  0.60110070<br />continent: Asia<br />country: West Bank and Gaza","intercept: 28.91936<br />year1950:  0.60545944<br />continent: Asia<br />country: Yemen, Rep."],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(117,112,179,1)","opacity":0.5,"size":7.55905511811024,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(117,112,179,1)"}},"hoveron":"points","name":"Asia","legendgroup":"Asia","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[58.5597617715618,65.964476923077,67.4737538461539,57.3900536130536,65.4459300699301,63.4048631701632,67.2384461538462,70.7909296037296,65.973124009324,67.3131254079255,67.1407617715618,66.5824079254079,65.7455226107226,71.6328386946387,67.1432223776224,66.0573738927739,61.6556254079254,71.616241958042,71.9507328671329,64.3884596736597,60.4723920745921,63.6473254079255,61.0240440559441,66.7417836829837,65.6852986013986,65.915958974359,71.2724909090909,69.009255011655,45.0278407925408,68.4365941724942],"y":[0.334683216783216,0.241992307692307,0.209084615384615,0.349755244755245,0.145688811188811,0.22545944055944,0.144815384615384,0.121330069930069,0.237925174825174,0.238501398601398,0.213683216783216,0.242398601398601,0.123648951048951,0.165375524475524,0.19911958041958,0.269710489510489,0.293001398601398,0.136686713286713,0.131941258741258,0.19621888111888,0.337201398601398,0.157401398601398,0.255151048951048,0.134044055944055,0.200523776223776,0.280930769230769,0.166254545454545,0.222231468531468,0.497239860139859,0.185965734265734],"text":["intercept: 58.55976<br />year1950:  0.33468322<br />continent: Europe<br />country: Albania","intercept: 65.96448<br />year1950:  0.24199231<br />continent: Europe<br />country: Austria","intercept: 67.47375<br />year1950:  0.20908462<br />continent: Europe<br />country: Belgium","intercept: 57.39005<br />year1950:  0.34975524<br />continent: Europe<br />country: Bosnia and Herzegovina","intercept: 65.44593<br />year1950:  0.14568881<br />continent: Europe<br />country: Bulgaria","intercept: 63.40486<br />year1950:  0.22545944<br />continent: Europe<br />country: Croatia","intercept: 67.23845<br />year1950:  0.14481538<br />continent: Europe<br />country: Czech Republic","intercept: 70.79093<br />year1950:  0.12133007<br />continent: Europe<br />country: Denmark","intercept: 65.97312<br />year1950:  0.23792517<br />continent: Europe<br />country: Finland","intercept: 67.31313<br />year1950:  0.23850140<br />continent: Europe<br />country: France","intercept: 67.14076<br />year1950:  0.21368322<br />continent: Europe<br />country: Germany","intercept: 66.58241<br />year1950:  0.24239860<br />continent: Europe<br />country: Greece","intercept: 65.74552<br />year1950:  0.12364895<br />continent: Europe<br />country: Hungary","intercept: 71.63284<br />year1950:  0.16537552<br />continent: Europe<br />country: Iceland","intercept: 67.14322<br />year1950:  0.19911958<br />continent: Europe<br />country: Ireland","intercept: 66.05737<br />year1950:  0.26971049<br />continent: Europe<br />country: Italy","intercept: 61.65563<br />year1950:  0.29300140<br />continent: Europe<br />country: Montenegro","intercept: 71.61624<br />year1950:  0.13668671<br />continent: Europe<br />country: Netherlands","intercept: 71.95073<br />year1950:  0.13194126<br />continent: Europe<br />country: Norway","intercept: 64.38846<br />year1950:  0.19621888<br />continent: Europe<br />country: Poland","intercept: 60.47239<br />year1950:  0.33720140<br />continent: Europe<br />country: Portugal","intercept: 63.64733<br />year1950:  0.15740140<br />continent: Europe<br />country: Romania","intercept: 61.02404<br />year1950:  0.25515105<br />continent: Europe<br />country: Serbia","intercept: 66.74178<br />year1950:  0.13404406<br />continent: Europe<br />country: Slovak Republic","intercept: 65.68530<br />year1950:  0.20052378<br />continent: Europe<br />country: Slovenia","intercept: 65.91596<br />year1950:  0.28093077<br />continent: Europe<br />country: Spain","intercept: 71.27249<br />year1950:  0.16625455<br />continent: Europe<br />country: Sweden","intercept: 69.00926<br />year1950:  0.22223147<br />continent: Europe<br />country: Switzerland","intercept: 45.02784<br />year1950:  0.49723986<br />continent: Europe<br />country: Turkey","intercept: 68.43659<br />year1950:  0.18596573<br />continent: Europe<br />country: United Kingdom"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(231,41,138,1)","opacity":0.5,"size":7.55905511811024,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(231,41,138,1)"}},"hoveron":"points","name":"Europe","legendgroup":"Europe","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[67.9450652680653,68.3012811188811],"y":[0.227723776223776,0.192820979020978],"text":["intercept: 67.94507<br />year1950:  0.22772378<br />continent: Oceania<br />country: Australia","intercept: 68.30128<br />year1950:  0.19282098<br />continent: Oceania<br />country: New Zealand"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(102,166,30,1)","opacity":0.5,"size":7.55905511811024,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(102,166,30,1)"}},"hoveron":"points","name":"Oceania","legendgroup":"Oceania","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":30.6118721461187,"r":7.30593607305936,"b":44.5662100456621,"l":43.1050228310502},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[25.0010194055945,74.1864335081585],"tickmode":"array","ticktext":["30","40","50","60","70"],"tickvals":[30,40,50,60,70],"categoryorder":"array","categoryarray":["30","40","50","60","70"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"intercept","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.136280979020979,0.815439020979021],"tickmode":"array","ticktext":["0.0","0.2","0.4","0.6","0.8"],"tickvals":[0,0.2,0.4,0.6,0.8],"categoryorder":"array","categoryarray":["0.0","0.2","0.4","0.6","0.8"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"year1950","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"title":{"text":"continent","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"105c815a4a3ec":{"x":{},"y":{},"colour":{},"label":{},"type":"scatter"}},"cur_data":"105c815a4a3ec","visdat":{"105c815a4a3ec":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Let’s summarise the information learned from the model coefficients.</p>
<ul>
<li>Generally the relationship is negative: this means that if a country started with a high intercept tends to have lower rate of increase.</li>
<li>There is a difference across the continents: Countries in Europe and Oceania tended to start with higher life expectancy and increased; countries in Asia and America tended to start lower but have high rates of improvement; Africa tends to start lower and have a huge range in rate of change.</li>
<li>Three countries had negative growth in life expectancy: Rwand, Zimbabwe, Zambia</li>
</ul>
</div>
</div>
<div id="model-diagnostics-by-country" class="section level2 hasAnchor" number="16.16">
<h2><span class="header-section-number">16.16</span> Model diagnostics by country<a href="model-fitting-and-optimisation.html#model-diagnostics-by-country" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="model-fitting-and-optimisation.html#cb206-1" aria-hidden="true" tabindex="-1"></a>country_fit <span class="ot">&lt;-</span> by_country <span class="sc">%&gt;%</span> </span>
<span id="cb206-2"><a href="model-fitting-and-optimisation.html#cb206-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> purrr<span class="sc">::</span><span class="fu">map</span>(model, broom<span class="sc">::</span>glance)) <span class="sc">%&gt;%</span></span>
<span id="cb206-3"><a href="model-fitting-and-optimisation.html#cb206-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(model)</span></code></pre></div>
<p>Or you can use a <code>for</code> loop to compute this.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="model-fitting-and-optimisation.html#cb207-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(gapminder2<span class="sc">$</span>country))</span>
<span id="cb207-2"><a href="model-fitting-and-optimisation.html#cb207-2" aria-hidden="true" tabindex="-1"></a>country_fit <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">country=</span>gapminder2<span class="sc">$</span>country[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1704</span>, <span class="dv">12</span>)],</span>
<span id="cb207-3"><a href="model-fitting-and-optimisation.html#cb207-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">continent=</span>gapminder2<span class="sc">$</span>continent[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1704</span>, <span class="dv">12</span>)],</span>
<span id="cb207-4"><a href="model-fitting-and-optimisation.html#cb207-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">intercept=</span><span class="fu">rep</span>(<span class="dv">0</span>,n), </span>
<span id="cb207-5"><a href="model-fitting-and-optimisation.html#cb207-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">year1950=</span><span class="fu">rep</span>(<span class="dv">0</span>,n),</span>
<span id="cb207-6"><a href="model-fitting-and-optimisation.html#cb207-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">r.squared=</span><span class="fu">rep</span>(<span class="dv">0</span>,n))</span>
<span id="cb207-7"><a href="model-fitting-and-optimisation.html#cb207-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb207-8"><a href="model-fitting-and-optimisation.html#cb207-8" aria-hidden="true" tabindex="-1"></a>  sub <span class="ot">&lt;-</span> gapminder2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country<span class="sc">==</span>country_fit<span class="sc">$</span>country[i])</span>
<span id="cb207-9"><a href="model-fitting-and-optimisation.html#cb207-9" aria-hidden="true" tabindex="-1"></a>  sub_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(lifeExp<span class="sc">~</span>year1950, <span class="at">data=</span>sub)</span>
<span id="cb207-10"><a href="model-fitting-and-optimisation.html#cb207-10" aria-hidden="true" tabindex="-1"></a>  sub_lm_fit <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(sub_lm)</span>
<span id="cb207-11"><a href="model-fitting-and-optimisation.html#cb207-11" aria-hidden="true" tabindex="-1"></a>  country_fit<span class="sc">$</span>intercept[i] <span class="ot">&lt;-</span> sub_lm_coefs[<span class="dv">1</span>]</span>
<span id="cb207-12"><a href="model-fitting-and-optimisation.html#cb207-12" aria-hidden="true" tabindex="-1"></a>  country_fit<span class="sc">$</span>year1950[i] <span class="ot">&lt;-</span> sub_lm_coefs[<span class="dv">2</span>]</span>
<span id="cb207-13"><a href="model-fitting-and-optimisation.html#cb207-13" aria-hidden="true" tabindex="-1"></a>  country_fit<span class="sc">$</span>r.squared[i] <span class="ot">&lt;-</span> <span class="fu">summary</span>(sub_lm)<span class="sc">$</span>r.squared</span>
<span id="cb207-14"><a href="model-fitting-and-optimisation.html#cb207-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb207-15"><a href="model-fitting-and-optimisation.html#cb207-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(country_fit)</span></code></pre></div>
<div id="plot-the-r2-values-as-a-histogram." class="section level3 hasAnchor" number="16.16.1">
<h3><span class="header-section-number">16.16.1</span> Plot the <span class="math inline">\(R^2\)</span> values as a histogram.<a href="model-fitting-and-optimisation.html#plot-the-r2-values-as-a-histogram." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="model-fitting-and-optimisation.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(country_fit, <span class="fu">aes</span>(<span class="at">x=</span>r.squared)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="book_files/figure-html/gapr2-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="countries-with-worst-fit" class="section level3 hasAnchor" number="16.16.2">
<h3><span class="header-section-number">16.16.2</span> Countries with worst fit<a href="model-fitting-and-optimisation.html#countries-with-worst-fit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Examine the countries with the worst fit, countries with <span class="math inline">\(R^2&lt;0.45\)</span>, by making scatterplots of the data, with the linear model overlaid.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="model-fitting-and-optimisation.html#cb209-1" aria-hidden="true" tabindex="-1"></a>badfit <span class="ot">&lt;-</span> country_fit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(r.squared <span class="sc">&lt;=</span> <span class="fl">0.45</span>)</span>
<span id="cb209-2"><a href="model-fitting-and-optimisation.html#cb209-2" aria-hidden="true" tabindex="-1"></a>gapminder2_sub <span class="ot">&lt;-</span> gapminder2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country <span class="sc">%in%</span> badfit<span class="sc">$</span>country)</span>
<span id="cb209-3"><a href="model-fitting-and-optimisation.html#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>gapminder2_sub, <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>lifeExp)) <span class="sc">+</span> </span>
<span id="cb209-4"><a href="model-fitting-and-optimisation.html#cb209-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb209-5"><a href="model-fitting-and-optimisation.html#cb209-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>country) <span class="sc">+</span></span>
<span id="cb209-6"><a href="model-fitting-and-optimisation.html#cb209-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">1950</span>,<span class="dv">2000</span>,<span class="dv">10</span>), </span>
<span id="cb209-7"><a href="model-fitting-and-optimisation.html#cb209-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;1950&quot;</span>, <span class="st">&quot;60&quot;</span>,<span class="st">&quot;70&quot;</span>, <span class="st">&quot;80&quot;</span>,<span class="st">&quot;90&quot;</span>,<span class="st">&quot;2000&quot;</span>)) <span class="sc">+</span></span>
<span id="cb209-8"><a href="model-fitting-and-optimisation.html#cb209-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">se=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/gappoor-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Each of these countries had been moving on a nice trajectory of increasing life expectancy, and then suffered a big dip during the time period.</p>
</div>
<div id="five-minute-challenge-1" class="section level3 hasAnchor" number="16.16.3">
<h3><span class="header-section-number">16.16.3</span> Five minute challenge<a href="model-fitting-and-optimisation.html#five-minute-challenge-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use google to explain these dips using world history and current affairs information.</p>
</div>
</div>
<div id="lab-exercise" class="section level2 hasAnchor" number="16.17">
<h2><span class="header-section-number">16.17</span> Lab exercise<a href="model-fitting-and-optimisation.html#lab-exercise" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Download the children per woman (total fertility) data from the <a href="https://www.gapminder.org/data/">gapminder web site</a></li>
<li>Conduct the same analysis, as done for life expectancy.</li>
<li>Find the unusual countries</li>
</ul>
<p>The code below will help you read in the data and process it, but you will need to make some changes to do the full analysis.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="model-fitting-and-optimisation.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb210-2"><a href="model-fitting-and-optimisation.html#cb210-2" aria-hidden="true" tabindex="-1"></a>fert <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data/children_per_woman_total_fertility.xlsx&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb210-3"><a href="model-fitting-and-optimisation.html#cb210-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">country =</span> geo)</span>
<span id="cb210-4"><a href="model-fitting-and-optimisation.html#cb210-4" aria-hidden="true" tabindex="-1"></a>fert <span class="ot">&lt;-</span> fert <span class="sc">%&gt;%</span> <span class="fu">gather</span>(year, fert, <span class="sc">-</span>country) <span class="sc">%&gt;%</span></span>
<span id="cb210-5"><a href="model-fitting-and-optimisation.html#cb210-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb210-6"><a href="model-fitting-and-optimisation.html#cb210-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">1950</span>) <span class="sc">%&gt;%</span></span>
<span id="cb210-7"><a href="model-fitting-and-optimisation.html#cb210-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year1950 =</span> year <span class="sc">-</span> <span class="dv">1950</span>)</span>
<span id="cb210-8"><a href="model-fitting-and-optimisation.html#cb210-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fert, <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>fert, <span class="at">group=</span>country)) <span class="sc">+</span></span>
<span id="cb210-9"><a href="model-fitting-and-optimisation.html#cb210-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha=</span><span class="fl">0.1</span>)</span></code></pre></div>
</div>
<div id="transformations" class="section level2 hasAnchor" number="16.18">
<h2><span class="header-section-number">16.18</span> Transformations<a href="model-fitting-and-optimisation.html#transformations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>Transform your work larvae to butterfly</em> (Image source: Jan Thornhill <a href="http://sci-why.blogspot.com/2013/04/help-save-monarch-butterfly.html" class="uri">http://sci-why.blogspot.com/2013/04/help-save-monarch-butterfly.html</a>)</p>
<p><img src="http://1.bp.blogspot.com/-uKdxzn5o2Wg/UV7I3tbENHI/AAAAAAAAAHI/qyOIUonkKLY/s1600/shutterstock_4485247monarch+%2526+caterpillar.jpg" width="50%"></p>
<ul>
<li><strong>Numerical variables</strong>, whether they are explanatory or response, work better for modeling if they are reasonably spread out. If they are right- or left-skewed the model puts more weight on the extreme values.</li>
<li><strong>Categorical variables</strong> may need to be re-levelled to balance classes, or remove low count classes.</li>
</ul>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="model-fitting-and-optimisation.html#cb211-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">100</span>)</span>
<span id="cb211-2"><a href="model-fitting-and-optimisation.html#cb211-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(x, <span class="at">y=</span><span class="dv">5-2</span><span class="sc">*</span>x<span class="sc">+</span><span class="fu">rnorm</span>(<span class="dv">100</span>), <span class="at">x2=</span>(<span class="dv">2</span><span class="sc">*</span>x)<span class="sc">^</span><span class="dv">10</span>)</span>
<span id="cb211-3"><a href="model-fitting-and-optimisation.html#cb211-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb211-4"><a href="model-fitting-and-optimisation.html#cb211-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb211-5"><a href="model-fitting-and-optimisation.html#cb211-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Ideal base for model&quot;</span>)</span>
<span id="cb211-6"><a href="model-fitting-and-optimisation.html#cb211-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x2, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb211-7"><a href="model-fitting-and-optimisation.html#cb211-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb211-8"><a href="model-fitting-and-optimisation.html#cb211-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Less stable base for model&quot;</span>)</span>
<span id="cb211-9"><a href="model-fitting-and-optimisation.html#cb211-9" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x2, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb211-10"><a href="model-fitting-and-optimisation.html#cb211-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Log x2&quot;</span>) <span class="sc">+</span></span>
<span id="cb211-11"><a href="model-fitting-and-optimisation.html#cb211-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb211-12"><a href="model-fitting-and-optimisation.html#cb211-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Log transform x over-corrects&quot;</span>)</span>
<span id="cb211-13"><a href="model-fitting-and-optimisation.html#cb211-13" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x2<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>), <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb211-14"><a href="model-fitting-and-optimisation.html#cb211-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;x2^(1/10)&quot;</span>) <span class="sc">+</span></span>
<span id="cb211-15"><a href="model-fitting-and-optimisation.html#cb211-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb211-16"><a href="model-fitting-and-optimisation.html#cb211-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Power transform x fixes&quot;</span>)</span>
<span id="cb211-17"><a href="model-fitting-and-optimisation.html#cb211-17" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, p4, <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/gaptransf-1.png" width="768" style="display: block; margin: auto;" /></p>
<div id="power-transformation" class="section level3 hasAnchor" number="16.18.1">
<h3><span class="header-section-number">16.18.1</span> Power transformation<a href="model-fitting-and-optimisation.html#power-transformation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is a family of transformations you can make on quantitative data to help “symmetrise” or “normalise” (make is bell-shaped) the data. These are also called Box-Cox transformations. For <span class="math inline">\(\lambda \in (-\infty, \infty)\)</span>,</p>
<p><span class="math display">\[x_i^{(\lambda)} = \frac{x_i^\lambda -1}{\lambda}  ~~~ \mbox{if} ~\lambda \neq 0\]</span></p>
<p>but if <span class="math inline">\(\lambda=0, x_i^{(\lambda)} =\ln{x_i}\)</span></p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="model-fitting-and-optimisation.html#cb212-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x1=</span><span class="fu">rexp</span>(<span class="dv">500</span>), <span class="at">x2=</span><span class="fu">runif</span>(<span class="dv">500</span>)<span class="sc">^</span><span class="dv">5</span>, <span class="at">x3=</span><span class="fu">abs</span>(<span class="dv">6</span><span class="sc">-</span><span class="fu">rexp</span>(<span class="dv">500</span>)))</span>
<span id="cb212-2"><a href="model-fitting-and-optimisation.html#cb212-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x1)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">&quot;black&quot;</span>, <span class="at">alpha=</span><span class="fl">0.7</span>)</span>
<span id="cb212-3"><a href="model-fitting-and-optimisation.html#cb212-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x2)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">&quot;black&quot;</span>, <span class="at">alpha=</span><span class="fl">0.7</span>)</span>
<span id="cb212-4"><a href="model-fitting-and-optimisation.html#cb212-4" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x3)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">&quot;black&quot;</span>, <span class="at">alpha=</span><span class="fl">0.7</span>)</span>
<span id="cb212-5"><a href="model-fitting-and-optimisation.html#cb212-5" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">log</span>(x1<span class="fl">+0.1</span>))) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">&quot;black&quot;</span>, <span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;lambda=0&quot;</span>)</span>
<span id="cb212-6"><a href="model-fitting-and-optimisation.html#cb212-6" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>((x2)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>))) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">&quot;black&quot;</span>, <span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;lambda=1/5&quot;</span>)</span>
<span id="cb212-7"><a href="model-fitting-and-optimisation.html#cb212-7" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>(x3<span class="sc">^</span><span class="dv">5-1</span>)<span class="sc">/</span><span class="dv">5</span>)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">fill=</span><span class="st">&quot;black&quot;</span>, <span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;lambda=5&quot;</span>)</span>
<span id="cb212-8"><a href="model-fitting-and-optimisation.html#cb212-8" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, p4, p5, p6, <span class="at">ncol=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/gaplambda-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>It may be necessary to <em>shift</em> the values into the domain suitable for the function. For example, to take a log, all values must be bigger than 1.</p>
</div>
<div id="transforming-categorical-variables" class="section level3 hasAnchor" number="16.18.2">
<h3><span class="header-section-number">16.18.2</span> Transforming categorical variables<a href="model-fitting-and-optimisation.html#transforming-categorical-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Categories with small numbers of counts may need ot be combined.</li>
<li>Ordered categories might be re-coded to reflect “real” difference between classes</li>
</ul>
<div id="example-flying-etiquette" class="section level4 hasAnchor" number="16.18.2.1">
<h4><span class="header-section-number">16.18.2.1</span> Example: flying etiquette<a href="model-fitting-and-optimisation.html#example-flying-etiquette" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="model-fitting-and-optimisation.html#cb213-1" aria-hidden="true" tabindex="-1"></a>fly <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/flying-etiquette.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-2"><a href="model-fitting-and-optimisation.html#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">How often do you travel by plane?</span><span class="st">`</span>, <span class="st">`</span><span class="at">Do you ever recline your seat when you fly?</span><span class="st">`</span>, <span class="st">`</span><span class="at">Is itrude to recline your seat on a plane?</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb213-3"><a href="model-fitting-and-optimisation.html#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">travel_freq=</span><span class="st">`</span><span class="at">How often do you travel by plane?</span><span class="st">`</span>,</span>
<span id="cb213-4"><a href="model-fitting-and-optimisation.html#cb213-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">recline=</span><span class="st">`</span><span class="at">Do you ever recline your seat when you fly?</span><span class="st">`</span>,</span>
<span id="cb213-5"><a href="model-fitting-and-optimisation.html#cb213-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">rude=</span><span class="st">`</span><span class="at">Is itrude to recline your seat on a plane?</span><span class="st">`</span>)</span>
<span id="cb213-6"><a href="model-fitting-and-optimisation.html#cb213-6" aria-hidden="true" tabindex="-1"></a>fly <span class="sc">%&gt;%</span> <span class="fu">count</span>(travel_freq, <span class="at">sort=</span><span class="cn">TRUE</span>)</span>
<span id="cb213-7"><a href="model-fitting-and-optimisation.html#cb213-7" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 × 2</span></span>
<span id="cb213-8"><a href="model-fitting-and-optimisation.html#cb213-8" aria-hidden="true" tabindex="-1"></a>  travel_freq               n</span>
<span id="cb213-9"><a href="model-fitting-and-optimisation.html#cb213-9" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                 <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb213-10"><a href="model-fitting-and-optimisation.html#cb213-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Once a year or less     <span class="dv">633</span></span>
<span id="cb213-11"><a href="model-fitting-and-optimisation.html#cb213-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Once a month or less    <span class="dv">205</span></span>
<span id="cb213-12"><a href="model-fitting-and-optimisation.html#cb213-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> Never                   <span class="dv">166</span></span>
<span id="cb213-13"><a href="model-fitting-and-optimisation.html#cb213-13" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> A few times per month    <span class="dv">29</span></span>
<span id="cb213-14"><a href="model-fitting-and-optimisation.html#cb213-14" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> A few times per week      <span class="dv">4</span></span>
<span id="cb213-15"><a href="model-fitting-and-optimisation.html#cb213-15" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> Every day                 <span class="dv">3</span></span></code></pre></div>
<p>How often a person flies, is a pretty important context variable for understanding people’s responses in the survey. There are two issues here:</p>
<ul>
<li>Categories <code>Every day</code>, <code>A few times per week</code> and even <code>A few times per month</code> have small counts. You may not have enough subjects from which to infer to the larger population of flyers in these categories.</li>
<li>Category <code>Never</code>!!! If they have never flown how can they provide useful information on flying etiquette?</li>
</ul>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="model-fitting-and-optimisation.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb214-2"><a href="model-fitting-and-optimisation.html#cb214-2" aria-hidden="true" tabindex="-1"></a>fly <span class="sc">%&gt;%</span> <span class="fu">count</span>(recline, <span class="at">sort=</span><span class="cn">TRUE</span>)</span>
<span id="cb214-3"><a href="model-fitting-and-optimisation.html#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 × 2</span></span>
<span id="cb214-4"><a href="model-fitting-and-optimisation.html#cb214-4" aria-hidden="true" tabindex="-1"></a>  recline                 n</span>
<span id="cb214-5"><a href="model-fitting-and-optimisation.html#cb214-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>               <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb214-6"><a href="model-fitting-and-optimisation.html#cb214-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Once <span class="cf">in</span> a <span class="cf">while</span>       <span class="dv">257</span></span>
<span id="cb214-7"><a href="model-fitting-and-optimisation.html#cb214-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>                  <span class="dv">182</span></span>
<span id="cb214-8"><a href="model-fitting-and-optimisation.html#cb214-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> Usually               <span class="dv">175</span></span>
<span id="cb214-9"><a href="model-fitting-and-optimisation.html#cb214-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> Never                 <span class="dv">171</span></span>
<span id="cb214-10"><a href="model-fitting-and-optimisation.html#cb214-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> Always                <span class="dv">137</span></span>
<span id="cb214-11"><a href="model-fitting-and-optimisation.html#cb214-11" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> About half the time   <span class="dv">118</span></span>
<span id="cb214-12"><a href="model-fitting-and-optimisation.html#cb214-12" aria-hidden="true" tabindex="-1"></a>fly <span class="sc">%&gt;%</span> <span class="fu">count</span>(rude, <span class="at">sort=</span><span class="cn">TRUE</span>)</span>
<span id="cb214-13"><a href="model-fitting-and-optimisation.html#cb214-13" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 4 × 2</span></span>
<span id="cb214-14"><a href="model-fitting-and-optimisation.html#cb214-14" aria-hidden="true" tabindex="-1"></a>  rude                    n</span>
<span id="cb214-15"><a href="model-fitting-and-optimisation.html#cb214-15" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>               <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb214-16"><a href="model-fitting-and-optimisation.html#cb214-16" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> No, not rude at all   <span class="dv">502</span></span>
<span id="cb214-17"><a href="model-fitting-and-optimisation.html#cb214-17" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Yes, somewhat rude    <span class="dv">281</span></span>
<span id="cb214-18"><a href="model-fitting-and-optimisation.html#cb214-18" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>                  <span class="dv">186</span></span>
<span id="cb214-19"><a href="model-fitting-and-optimisation.html#cb214-19" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> Yes, very rude         <span class="dv">71</span></span>
<span id="cb214-20"><a href="model-fitting-and-optimisation.html#cb214-20" aria-hidden="true" tabindex="-1"></a>fly <span class="sc">%&gt;%</span>   <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(recline)) <span class="sc">%&gt;%</span></span>
<span id="cb214-21"><a href="model-fitting-and-optimisation.html#cb214-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rude)) <span class="sc">%&gt;%</span></span>
<span id="cb214-22"><a href="model-fitting-and-optimisation.html#cb214-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(recline, rude, <span class="at">sort=</span><span class="cn">TRUE</span>)</span>
<span id="cb214-23"><a href="model-fitting-and-optimisation.html#cb214-23" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 14 × 3</span></span>
<span id="cb214-24"><a href="model-fitting-and-optimisation.html#cb214-24" aria-hidden="true" tabindex="-1"></a>   recline             rude                    n</span>
<span id="cb214-25"><a href="model-fitting-and-optimisation.html#cb214-25" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>               <span class="er">&lt;</span>chr<span class="sc">&gt;</span>               <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb214-26"><a href="model-fitting-and-optimisation.html#cb214-26" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span> Usually             No, not rude at all   <span class="dv">145</span></span>
<span id="cb214-27"><a href="model-fitting-and-optimisation.html#cb214-27" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span> Once <span class="cf">in</span> a <span class="cf">while</span>     Yes, somewhat rude    <span class="dv">129</span></span>
<span id="cb214-28"><a href="model-fitting-and-optimisation.html#cb214-28" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span> Always              No, not rude at all   <span class="dv">124</span></span>
<span id="cb214-29"><a href="model-fitting-and-optimisation.html#cb214-29" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span> Once <span class="cf">in</span> a <span class="cf">while</span>     No, not rude at all   <span class="dv">116</span></span>
<span id="cb214-30"><a href="model-fitting-and-optimisation.html#cb214-30" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span> About half the time No, not rude at all    <span class="dv">82</span></span>
<span id="cb214-31"><a href="model-fitting-and-optimisation.html#cb214-31" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span> Never               Yes, somewhat rude     <span class="dv">81</span></span>
<span id="cb214-32"><a href="model-fitting-and-optimisation.html#cb214-32" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span> Never               Yes, very rude         <span class="dv">54</span></span>
<span id="cb214-33"><a href="model-fitting-and-optimisation.html#cb214-33" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span> About half the time Yes, somewhat rude     <span class="dv">35</span></span>
<span id="cb214-34"><a href="model-fitting-and-optimisation.html#cb214-34" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span> Never               No, not rude at all    <span class="dv">35</span></span>
<span id="cb214-35"><a href="model-fitting-and-optimisation.html#cb214-35" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> Usually             Yes, somewhat rude     <span class="dv">27</span></span>
<span id="cb214-36"><a href="model-fitting-and-optimisation.html#cb214-36" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span> Once <span class="cf">in</span> a <span class="cf">while</span>     Yes, very rude         <span class="dv">11</span></span>
<span id="cb214-37"><a href="model-fitting-and-optimisation.html#cb214-37" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span> Always              Yes, somewhat rude      <span class="dv">9</span></span>
<span id="cb214-38"><a href="model-fitting-and-optimisation.html#cb214-38" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span> Always              Yes, very rude          <span class="dv">3</span></span>
<span id="cb214-39"><a href="model-fitting-and-optimisation.html#cb214-39" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span> Usually             Yes, very rude          <span class="dv">3</span></span>
<span id="cb214-40"><a href="model-fitting-and-optimisation.html#cb214-40" aria-hidden="true" tabindex="-1"></a>fly <span class="sc">%&gt;%</span> </span>
<span id="cb214-41"><a href="model-fitting-and-optimisation.html#cb214-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(recline)) <span class="sc">%&gt;%</span></span>
<span id="cb214-42"><a href="model-fitting-and-optimisation.html#cb214-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rude)) <span class="sc">%&gt;%</span></span>
<span id="cb214-43"><a href="model-fitting-and-optimisation.html#cb214-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">recline =</span> <span class="fu">fct_recode</span>(recline, <span class="at">Always =</span> <span class="st">&quot;Usually&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb214-44"><a href="model-fitting-and-optimisation.html#cb214-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(recline, rude, <span class="at">sort=</span><span class="cn">TRUE</span>)</span>
<span id="cb214-45"><a href="model-fitting-and-optimisation.html#cb214-45" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 11 × 3</span></span>
<span id="cb214-46"><a href="model-fitting-and-optimisation.html#cb214-46" aria-hidden="true" tabindex="-1"></a>   recline             rude                    n</span>
<span id="cb214-47"><a href="model-fitting-and-optimisation.html#cb214-47" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>fct<span class="sc">&gt;</span>               <span class="er">&lt;</span>chr<span class="sc">&gt;</span>               <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb214-48"><a href="model-fitting-and-optimisation.html#cb214-48" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span> Always              No, not rude at all   <span class="dv">269</span></span>
<span id="cb214-49"><a href="model-fitting-and-optimisation.html#cb214-49" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span> Once <span class="cf">in</span> a <span class="cf">while</span>     Yes, somewhat rude    <span class="dv">129</span></span>
<span id="cb214-50"><a href="model-fitting-and-optimisation.html#cb214-50" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span> Once <span class="cf">in</span> a <span class="cf">while</span>     No, not rude at all   <span class="dv">116</span></span>
<span id="cb214-51"><a href="model-fitting-and-optimisation.html#cb214-51" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span> About half the time No, not rude at all    <span class="dv">82</span></span>
<span id="cb214-52"><a href="model-fitting-and-optimisation.html#cb214-52" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span> Never               Yes, somewhat rude     <span class="dv">81</span></span>
<span id="cb214-53"><a href="model-fitting-and-optimisation.html#cb214-53" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span> Never               Yes, very rude         <span class="dv">54</span></span>
<span id="cb214-54"><a href="model-fitting-and-optimisation.html#cb214-54" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span> Always              Yes, somewhat rude     <span class="dv">36</span></span>
<span id="cb214-55"><a href="model-fitting-and-optimisation.html#cb214-55" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span> About half the time Yes, somewhat rude     <span class="dv">35</span></span>
<span id="cb214-56"><a href="model-fitting-and-optimisation.html#cb214-56" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span> Never               No, not rude at all    <span class="dv">35</span></span>
<span id="cb214-57"><a href="model-fitting-and-optimisation.html#cb214-57" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> Once <span class="cf">in</span> a <span class="cf">while</span>     Yes, very rude         <span class="dv">11</span></span>
<span id="cb214-58"><a href="model-fitting-and-optimisation.html#cb214-58" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span> Always              Yes, very rude          <span class="dv">6</span></span></code></pre></div>
<ul>
<li>Single variables have healthy counts</li>
<li>But pairs of variables, some combinations of levels have low counts</li>
<li>Collapsing two or more categories into one, might build better support</li>
</ul>
</div>
</div>
</div>
<div id="adding-interactions-to-the-model" class="section level2 hasAnchor" number="16.19">
<h2><span class="header-section-number">16.19</span> Adding interactions to the model<a href="model-fitting-and-optimisation.html#adding-interactions-to-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><img src="images/interaction.png" /></p>
<div id="interaction-between-quantitative-and-categorical-variables" class="section level3 hasAnchor" number="16.19.1">
<h3><span class="header-section-number">16.19.1</span> Interaction between quantitative and categorical variables<a href="model-fitting-and-optimisation.html#interaction-between-quantitative-and-categorical-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An interaction term is needed in a model if the linear relationship is different for the response vs quantitative variable for different levels of the categorical variable. That is, a different <em>slope</em> needs to be used/estimated for each level.</p>
<p>Let’s take a look at how this works for the <a href="http://www.oecd.org/pisa/data/2015database/">2015 OECD PISA data</a>. The question to be answered is whether more time spent studying science is associated with higher science scores, and how this varies with enjoyment of science.</p>
<p><img src="book_files/figure-html/pisa-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>There are two possible models:</p>
<p><span class="math inline">\(y_i = \beta_0+\beta_1x_{i1}+\beta_2x_{i2}+\varepsilon_i\)</span> (Model 1)</p>
<p><span class="math inline">\(y_i = \beta_0+\beta_1x_{i1}+\beta_2x_{i2}+\beta_3x_{i1}*x_{i2}+\varepsilon_i\)</span> (Model 2)</p>
<p>where <span class="math inline">\(y=\)</span> science score, <span class="math inline">\(x_1=\)</span> science study time, <span class="math inline">\(x_2=\)</span> science enjoyment.</p>
<p>Model 2 has an interaction term. This means that the slope will be allowed to vary for the different levels of the categorical variables, science_fun.</p>
<p><em>Note:</em> Ordered factors are treated as “numeric” in the default model fit, so we should convert <code>science_fun</code> to be an unordered categorical variable. Also, <code>science_time</code> is heavily skewed so should be transformed.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="model-fitting-and-optimisation.html#cb215-1" aria-hidden="true" tabindex="-1"></a>pisa_au_science <span class="ot">&lt;-</span> pisa_au_science <span class="sc">%&gt;%</span></span>
<span id="cb215-2"><a href="model-fitting-and-optimisation.html#cb215-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_science_time =</span> <span class="fu">log10</span>(science_time)) <span class="sc">%&gt;%</span></span>
<span id="cb215-3"><a href="model-fitting-and-optimisation.html#cb215-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">science_fun_c =</span> <span class="fu">factor</span>(science_fun, <span class="at">ordered=</span><span class="cn">FALSE</span>))</span>
<span id="cb215-4"><a href="model-fitting-and-optimisation.html#cb215-4" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(science<span class="sc">~</span>log_science_time<span class="sc">+</span>science_fun_c, <span class="at">data=</span>pisa_au_science, <span class="at">weights =</span> stuweight)</span>
<span id="cb215-5"><a href="model-fitting-and-optimisation.html#cb215-5" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(science<span class="sc">~</span>log_science_time<span class="sc">*</span>science_fun_c, <span class="at">data=</span>pisa_au_science, <span class="at">weights =</span> stuweight)</span>
<span id="cb215-6"><a href="model-fitting-and-optimisation.html#cb215-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mod1)</span>
<span id="cb215-7"><a href="model-fitting-and-optimisation.html#cb215-7" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 5 × 5</span></span>
<span id="cb215-8"><a href="model-fitting-and-optimisation.html#cb215-8" aria-hidden="true" tabindex="-1"></a>  term             estimate std.error statistic   p.value</span>
<span id="cb215-9"><a href="model-fitting-and-optimisation.html#cb215-9" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>               <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb215-10"><a href="model-fitting-and-optimisation.html#cb215-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> (Intercept)         <span class="fl">268.</span>      <span class="fl">14.6</span>       <span class="fl">18.3</span> <span class="fl">1.26</span>e<span class="sc">-</span> <span class="dv">73</span></span>
<span id="cb215-11"><a href="model-fitting-and-optimisation.html#cb215-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> log_science_time     <span class="fl">83.8</span>      <span class="fl">6.18</span>      <span class="fl">13.6</span> <span class="fl">1.31</span>e<span class="sc">-</span> <span class="dv">41</span></span>
<span id="cb215-12"><a href="model-fitting-and-optimisation.html#cb215-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> science_fun_c2       <span class="fl">31.8</span>      <span class="fl">3.15</span>      <span class="fl">10.1</span> <span class="fl">9.28</span>e<span class="sc">-</span> <span class="dv">24</span></span>
<span id="cb215-13"><a href="model-fitting-and-optimisation.html#cb215-13" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> science_fun_c3       <span class="fl">63.1</span>      <span class="fl">2.80</span>      <span class="fl">22.5</span> <span class="fl">7.17e-110</span></span>
<span id="cb215-14"><a href="model-fitting-and-optimisation.html#cb215-14" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> science_fun_c4      <span class="fl">104.</span>       <span class="fl">3.25</span>      <span class="fl">32.1</span> <span class="fl">3.00e-216</span></span>
<span id="cb215-15"><a href="model-fitting-and-optimisation.html#cb215-15" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mod2)</span>
<span id="cb215-16"><a href="model-fitting-and-optimisation.html#cb215-16" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 8 × 5</span></span>
<span id="cb215-17"><a href="model-fitting-and-optimisation.html#cb215-17" aria-hidden="true" tabindex="-1"></a>  term                              estimate std.error statistic  p.value</span>
<span id="cb215-18"><a href="model-fitting-and-optimisation.html#cb215-18" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                                <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb215-19"><a href="model-fitting-and-optimisation.html#cb215-19" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> (Intercept)                      <span class="fl">463.</span>           <span class="fl">43.5</span> <span class="fl">10.6</span>      <span class="fl">2.37e-26</span></span>
<span id="cb215-20"><a href="model-fitting-and-optimisation.html#cb215-20" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> log_science_time                  <span class="sc">-</span><span class="fl">0.00400</span>      <span class="fl">18.6</span> <span class="sc">-</span><span class="fl">0.000215</span> <span class="fl">1.00</span>e<span class="sc">+</span> <span class="dv">0</span></span>
<span id="cb215-21"><a href="model-fitting-and-optimisation.html#cb215-21" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> science_fun_c2                  <span class="sc">-</span><span class="fl">152.</span>           <span class="fl">55.5</span> <span class="sc">-</span><span class="fl">2.74</span>     <span class="fl">6.18</span>e<span class="sc">-</span> <span class="dv">3</span></span>
<span id="cb215-22"><a href="model-fitting-and-optimisation.html#cb215-22" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> science_fun_c3                  <span class="sc">-</span><span class="fl">167.</span>           <span class="fl">48.1</span> <span class="sc">-</span><span class="fl">3.46</span>     <span class="fl">5.33</span>e<span class="sc">-</span> <span class="dv">4</span></span>
<span id="cb215-23"><a href="model-fitting-and-optimisation.html#cb215-23" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> science_fun_c4                  <span class="sc">-</span><span class="fl">122.</span>           <span class="fl">53.6</span> <span class="sc">-</span><span class="fl">2.29</span>     <span class="fl">2.23</span>e<span class="sc">-</span> <span class="dv">2</span></span>
<span id="cb215-24"><a href="model-fitting-and-optimisation.html#cb215-24" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> log_science_time<span class="sc">:</span>science_fun_c2   <span class="fl">78.6</span>          <span class="fl">23.8</span>  <span class="fl">3.31</span>     <span class="fl">9.33</span>e<span class="sc">-</span> <span class="dv">4</span></span>
<span id="cb215-25"><a href="model-fitting-and-optimisation.html#cb215-25" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span> log_science_time<span class="sc">:</span>science_fun_c3   <span class="fl">98.4</span>          <span class="fl">20.6</span>  <span class="fl">4.78</span>     <span class="fl">1.74</span>e<span class="sc">-</span> <span class="dv">6</span></span>
<span id="cb215-26"><a href="model-fitting-and-optimisation.html#cb215-26" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span> log_science_time<span class="sc">:</span>science_fun_c4   <span class="fl">96.9</span>          <span class="fl">22.8</span>  <span class="fl">4.25</span>     <span class="fl">2.11</span>e<span class="sc">-</span> <span class="dv">5</span></span></code></pre></div>
</div>
<div id="five-minute-challenge-2" class="section level3 hasAnchor" number="16.19.2">
<h3><span class="header-section-number">16.19.2</span> Five minute challenge<a href="model-fitting-and-optimisation.html#five-minute-challenge-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Write out the equations for both models. (Ignore the log transformation.)</li>
<li>Make a <strong>hand</strong> sketch of both models.</li>
</ul>
</div>
<div id="which-is-the-better-model" class="section level3 hasAnchor" number="16.19.3">
<h3><span class="header-section-number">16.19.3</span> Which is the better model?<a href="model-fitting-and-optimisation.html#which-is-the-better-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="model-fitting-and-optimisation.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(mod1)</span>
<span id="cb216-2"><a href="model-fitting-and-optimisation.html#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 1 × 12</span></span>
<span id="cb216-3"><a href="model-fitting-and-optimisation.html#cb216-3" aria-hidden="true" tabindex="-1"></a>  r.squared adj.r.squared sigma statistic   p.value    df  logLik     AIC    BIC</span>
<span id="cb216-4"><a href="model-fitting-and-optimisation.html#cb216-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>         <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb216-5"><a href="model-fitting-and-optimisation.html#cb216-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="fl">0.123</span>         <span class="fl">0.123</span>  <span class="fl">387.</span>      <span class="fl">385.</span> <span class="fl">6.87e-311</span>     <span class="dv">4</span> <span class="sc">-</span><span class="fl">66706.</span> <span class="fl">133424.</span> <span class="fl">1.33e5</span></span>
<span id="cb216-6"><a href="model-fitting-and-optimisation.html#cb216-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</span></span>
<span id="cb216-7"><a href="model-fitting-and-optimisation.html#cb216-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(mod2)</span>
<span id="cb216-8"><a href="model-fitting-and-optimisation.html#cb216-8" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 1 × 12</span></span>
<span id="cb216-9"><a href="model-fitting-and-optimisation.html#cb216-9" aria-hidden="true" tabindex="-1"></a>  r.squared adj.r.squared sigma statistic   p.value    df  logLik     AIC    BIC</span>
<span id="cb216-10"><a href="model-fitting-and-optimisation.html#cb216-10" aria-hidden="true" tabindex="-1"></a>      <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>         <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb216-11"><a href="model-fitting-and-optimisation.html#cb216-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="fl">0.125</span>         <span class="fl">0.125</span>  <span class="fl">387.</span>      <span class="fl">224.</span> <span class="fl">2.62e-312</span>     <span class="dv">7</span> <span class="sc">-</span><span class="fl">66694.</span> <span class="fl">133406.</span> <span class="fl">1.33e5</span></span>
<span id="cb216-12"><a href="model-fitting-and-optimisation.html#cb216-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</span></span></code></pre></div>
<p>🤯 they are both pretty bad! The interaction model (mod2) is slightly better but its really not.</p>
</div>
<div id="interaction-between-quantitative-variables" class="section level3 hasAnchor" number="16.19.4">
<h3><span class="header-section-number">16.19.4</span> Interaction between quantitative variables<a href="model-fitting-and-optimisation.html#interaction-between-quantitative-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Interactions for two quantitative variables in a model, can be thought of as allowing the paper sheet (model) to curl.</li>
</ul>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="model-fitting-and-optimisation.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb217-2"><a href="model-fitting-and-optimisation.html#cb217-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">500</span>)</span>
<span id="cb217-3"><a href="model-fitting-and-optimisation.html#cb217-3" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">500</span>)</span>
<span id="cb217-4"><a href="model-fitting-and-optimisation.html#cb217-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(x1, x2, <span class="at">y1=</span><span class="dv">5-2</span><span class="sc">*</span>x1<span class="sc">+</span><span class="dv">4</span><span class="sc">*</span>x2<span class="sc">+</span><span class="fu">rnorm</span>(<span class="dv">500</span>)<span class="sc">*</span><span class="fl">0.5</span>,</span>
<span id="cb217-5"><a href="model-fitting-and-optimisation.html#cb217-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y2=</span><span class="dv">5-2</span><span class="sc">*</span>x1<span class="sc">+</span><span class="dv">4</span><span class="sc">*</span>x2<span class="sc">+</span><span class="dv">10</span><span class="sc">*</span>(<span class="sc">-</span>x1)<span class="sc">*</span>x2<span class="sc">+</span><span class="fu">rnorm</span>(<span class="dv">500</span>)<span class="sc">*</span><span class="fl">0.5</span>)</span>
<span id="cb217-6"><a href="model-fitting-and-optimisation.html#cb217-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">colour=</span>y1)) <span class="sc">+</span> </span>
<span id="cb217-7"><a href="model-fitting-and-optimisation.html#cb217-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">5</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb217-8"><a href="model-fitting-and-optimisation.html#cb217-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis</span>() <span class="sc">+</span> </span>
<span id="cb217-9"><a href="model-fitting-and-optimisation.html#cb217-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>, <span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb217-10"><a href="model-fitting-and-optimisation.html#cb217-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Flat sheet: no interaction&quot;</span>)</span>
<span id="cb217-11"><a href="model-fitting-and-optimisation.html#cb217-11" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">colour=</span>y2)) <span class="sc">+</span> </span>
<span id="cb217-12"><a href="model-fitting-and-optimisation.html#cb217-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">5</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb217-13"><a href="model-fitting-and-optimisation.html#cb217-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis</span>() <span class="sc">+</span> </span>
<span id="cb217-14"><a href="model-fitting-and-optimisation.html#cb217-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>, <span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb217-15"><a href="model-fitting-and-optimisation.html#cb217-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Curled sheet: needs an interaction term&quot;</span>)</span>
<span id="cb217-16"><a href="model-fitting-and-optimisation.html#cb217-16" aria-hidden="true" tabindex="-1"></a>df_loess1 <span class="ot">&lt;-</span> <span class="fu">loess</span>(y1<span class="sc">~</span>x1<span class="sc">+</span>x2, <span class="at">data=</span>df)</span>
<span id="cb217-17"><a href="model-fitting-and-optimisation.html#cb217-17" aria-hidden="true" tabindex="-1"></a>df_loess2 <span class="ot">&lt;-</span> <span class="fu">loess</span>(y2<span class="sc">~</span>x1<span class="sc">+</span>x2, <span class="at">data=</span>df)</span>
<span id="cb217-18"><a href="model-fitting-and-optimisation.html#cb217-18" aria-hidden="true" tabindex="-1"></a>df_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1=</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">x2=</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>))</span>
<span id="cb217-19"><a href="model-fitting-and-optimisation.html#cb217-19" aria-hidden="true" tabindex="-1"></a>df_grid <span class="ot">&lt;-</span> df_grid <span class="sc">%&gt;%</span></span>
<span id="cb217-20"><a href="model-fitting-and-optimisation.html#cb217-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y1 =</span> <span class="fu">as.vector</span>(<span class="fu">predict</span>(df_loess1, <span class="at">newdata=</span>df_grid)),</span>
<span id="cb217-21"><a href="model-fitting-and-optimisation.html#cb217-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">y2 =</span> <span class="fu">as.vector</span>(<span class="fu">predict</span>(df_loess2, <span class="at">newdata=</span>df_grid)))</span>
<span id="cb217-22"><a href="model-fitting-and-optimisation.html#cb217-22" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_grid, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z=</span>y1, <span class="at">colour=</span>y1)) <span class="sc">+</span> </span>
<span id="cb217-23"><a href="model-fitting-and-optimisation.html#cb217-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">colour =</span> <span class="fu">stat</span>(level))) <span class="sc">+</span> </span>
<span id="cb217-24"><a href="model-fitting-and-optimisation.html#cb217-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis</span>() <span class="sc">+</span> </span>
<span id="cb217-25"><a href="model-fitting-and-optimisation.html#cb217-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>, <span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb217-26"><a href="model-fitting-and-optimisation.html#cb217-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Flat sheet: no interaction&quot;</span>) <span class="sc">+</span> </span>
<span id="cb217-27"><a href="model-fitting-and-optimisation.html#cb217-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>df, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">colour=</span>y1), <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">alpha=</span><span class="fl">0.5</span>)</span>
<span id="cb217-28"><a href="model-fitting-and-optimisation.html#cb217-28" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_grid, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">z=</span>y2)) <span class="sc">+</span> </span>
<span id="cb217-29"><a href="model-fitting-and-optimisation.html#cb217-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">colour =</span> <span class="fu">stat</span>(level))) <span class="sc">+</span> </span>
<span id="cb217-30"><a href="model-fitting-and-optimisation.html#cb217-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis</span>() <span class="sc">+</span> </span>
<span id="cb217-31"><a href="model-fitting-and-optimisation.html#cb217-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>, <span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb217-32"><a href="model-fitting-and-optimisation.html#cb217-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Curled sheet: needs an interaction term&quot;</span>) <span class="sc">+</span> </span>
<span id="cb217-33"><a href="model-fitting-and-optimisation.html#cb217-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>df, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">colour=</span>y2), <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">alpha=</span><span class="fl">0.5</span>)</span>
<span id="cb217-34"><a href="model-fitting-and-optimisation.html#cb217-34" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, p4, <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/pisainteract-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="five-minute-challenge-3" class="section level3 hasAnchor" number="16.19.5">
<h3><span class="header-section-number">16.19.5</span> Five minute challenge<a href="model-fitting-and-optimisation.html#five-minute-challenge-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Using the PISA data: How does science score relate to text anxiety and gender?
- Make a plot of science by anxtest, coloured by gender. Does it look like an interaction term might be necessary?
- Fit the model with <code>science</code> score as the response and <code>gender</code> and <code>anxtest</code>.
- Try an interaction between gender and anxtest.
- Which is the better model?</p>
<p>The code below has <code>???</code> where you need to replace with something sensible.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="model-fitting-and-optimisation.html#cb218-1" aria-hidden="true" tabindex="-1"></a>pisa_au_science <span class="ot">&lt;-</span> pisa_au <span class="sc">%&gt;%</span> </span>
<span id="cb218-2"><a href="model-fitting-and-optimisation.html#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(???)) <span class="sc">%&gt;%</span></span>
<span id="cb218-3"><a href="model-fitting-and-optimisation.html#cb218-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(science, gender, anxtest, stuweight) </span>
<span id="cb218-4"><a href="model-fitting-and-optimisation.html#cb218-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pisa_au_science, <span class="fu">aes</span>(<span class="at">x=</span>anxtest, <span class="at">y=</span>science, <span class="at">colour=</span>gender)) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>)</span>
<span id="cb218-5"><a href="model-fitting-and-optimisation.html#cb218-5" aria-hidden="true" tabindex="-1"></a>sci_lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(science <span class="sc">~</span> ??? <span class="sc">+</span> ???, <span class="at">data=</span>pisa_au_science, <span class="at">weights=</span>stuweight)</span>
<span id="cb218-6"><a href="model-fitting-and-optimisation.html#cb218-6" aria-hidden="true" tabindex="-1"></a>sci_lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(science <span class="sc">~</span> ??? <span class="sc">*</span> ???, <span class="at">data=</span>pisa_au_science, <span class="at">weights=</span>stuweight)</span>
<span id="cb218-7"><a href="model-fitting-and-optimisation.html#cb218-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(???)</span>
<span id="cb218-8"><a href="model-fitting-and-optimisation.html#cb218-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(???)</span></code></pre></div>
</div>
</div>
<div id="model-building" class="section level2 hasAnchor" number="16.20">
<h2><span class="header-section-number">16.20</span> Model building<a href="model-fitting-and-optimisation.html#model-building" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Goal: The simplest model possible that provides similar predictive accuracy to most complex model.</p>
<p>Approach:</p>
<ul>
<li>Start simply, fit main effects models (single best variable, adding several more variables independently) and try to understand the effect that each has in the model.</li>
<li>Explore transformations with the aim to build a stable foundation of explanatory variables for the model.</li>
<li>Check model diagnostics, residual plots.</li>
<li>Explore two variable interactions, and understand effect on model.</li>
<li>Explore three variable interactions.</li>
<li>Use model goodness of fit to help decide on final. There may be more than one model that are almost equally as good.</li>
</ul>
<p><em>Aside:</em> Ideally, values of explanatory variables cover all possible combinations in their domain. There should <em>not be any association between explanatory variables</em>. If there is, then the there is more uncertainty in the parameter estimates. Its like building a table with only two legs, that table would be a bit wobbly, and unstable. A work around is to first regress one explanatory variable on the other, and add the residuals from this fit to the model, instead of the original variable. That is, suppose <span class="math inline">\(X_1, X_2\)</span> are strongly linearly associated, then model <span class="math inline">\(X_2\sim b_0+b_1X_1+e\)</span>, and use <span class="math inline">\(e\)</span> (call it <span class="math inline">\(X^*_2\)</span>) in the model instead of <span class="math inline">\(X_2\)</span>. You would then only be using the part of <span class="math inline">\(X_2\)</span> that is not related to <span class="math inline">\(X_1\)</span> to expand the model. This approach can be used for multiple explanatory variables that are associated.</p>
<div id="lab-exercise-1" class="section level3 hasAnchor" number="16.20.1">
<h3><span class="header-section-number">16.20.1</span> Lab exercise<a href="model-fitting-and-optimisation.html#lab-exercise-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Build the best model you can for science score, by exploring these variables: math score, reading score, tvs, books, breakfast, feel free to choose others. (Code provided in Rmd is just a sample, and needs to be modified.)</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="variation-and-inference-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="generalied-linear-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/heike/data-technologies/edit/master/05e-model-fitting-and-optimisation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": false
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
